{"remainingRequest":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\huangcaiplace\\zhihuiguanqu\\src\\App.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\huangcaiplace\\zhihuiguanqu\\src\\App.vue","mtime":1586851914892},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport(\"./assets/shp.min.js\");\r\nimport { loadModules } from \"esri-loader\";\r\n// 引入Vue\r\nimport Vue from \"vue\";\r\n\r\n// 引入页面\r\nimport Table from \"./page/Table\";\r\n\r\n// 渠道水情\r\nimport BaseBoxQUDAO from \"@/components/BaseBox/BaseBox-qudaoshuiqing.vue\";\r\nimport DetailQUDAO from \"@/components/Details/Details-qudaoshuiqing.vue\";\r\n// 闸阀状态\r\nimport BaseBoxZHAFAZHUANGTAI from \"@/components/BaseBox/BaseBox-zhafazhuangtai.vue\";\r\nimport DetailZHAFAZHUANGTAI from \"@/components/Details/Details-zhafazhuangtai.vue\";\r\n// 闸阀水情\r\nimport BaseBoxZHAFASHUIQING from \"@/components/BaseBox/BaseBox-zhafashuiqing.vue\";\r\nimport DetailZHAFASHUIQING from \"@/components/Details/Details-zhafashuiqing.vue\";\r\n// 雨情\r\nimport BaseBoxYUQING from \"@/components/BaseBox/BaseBox-yuqing.vue\";\r\nimport DetailYUQING from \"@/components/Details/Details-yuqing.vue\";\r\n// 水库水情\r\nimport BaseBoxSHUIKUSHUIQING from \"@/components/BaseBox/BaseBox-shuikushuiqing.vue\";\r\nimport DetailSHUIKUSHUIQING from \"@/components/Details/Details-shuikushuiqing.vue\";\r\n// 河道水情\r\nimport BaseBoxHEDAOSHUIQING from \"@/components/BaseBox/BaseBox-hedaoshuiqing.vue\";\r\nimport DetailHEDAOSHUIQING from \"@/components/Details/Details-hedaoshuiqing.vue\";\r\n// 视频站\r\nimport BaseBoxSHIPINZHAN from \"@/components/BaseBox/BaseBox-shipinzhan.vue\";\r\nimport DetailSHIPINZHAN from \"@/components/Details/Details-shipinzhan.vue\";\r\n// 图像站站\r\nimport BaseBoxTUXIANGZHAN from \"@/components/BaseBox/BaseBox-tuxiangzhan.vue\";\r\nimport DetailTUXIANGZHAN from \"@/components/Details/Details-tuxiangzhan.vue\";\r\n// 运行工况\r\nimport BaseBoxYUNXINGGONGKUANG from \"@/components/BaseBox/BaseBox-yunxinggongkuang.vue\";\r\nimport DetailYUNXINGGONGKUANG from \"@/components/Details/Details-yunxinggongkuang.vue\";\r\nimport { debuglog } from \"util\";\r\n// 水位库容\r\nimport DetailSHUIWEIKURONG from \"@/components/Details/Details-shuiweikurong.vue\";\r\n\r\n// 引入公用方法\r\nimport FilterMethods from \"@/assets/commonJS/FilterMethods\";\r\nimport GetDataMethods from \"@/assets/commonJS/GetDataMethods\";\r\nimport { parse } from \"path\";\r\nimport { constants } from \"crypto\";\r\nimport $ from 'jquery'\r\n\r\n\r\nconst options = { version: \"3.28\" };\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      //三维仿真\r\n      mapBox3D:0,\r\n      //ditu.json 加载到的各个图层\r\n      //koen 20190911\r\n      tu_ceng_list:[],\r\n\r\n      //当前中心点\r\n      zhong_xin_dian:null,\r\n\r\n      //地图类型\r\n      ditu_type: 'topo',\r\n\r\n\r\n\r\n      listWindow_show_Controller: false,\r\n      // 列表窗口对象\r\n      listWindow: {\r\n        // 列表窗显示控制器\r\n        show_Controller: false,\r\n        // 列表窗形态切换\r\n        mode: 0,\r\n        activeName: \"qudaoshuiqing\"\r\n      },\r\n      mapBox_show: 1,\r\n      imgflag:\"\",\r\n      test: true,\r\n      map: null,\r\n      details: {\r\n        // 详情标题\r\n        drawer_title: \"详情\",\r\n        // 用于控制 右侧详情栏\r\n        drawer_show_right: false, // 显示隐藏\r\n        info_right: { fff: \"5\" }, // 右侧详情栏信息\r\n        // 用于控制 左侧详情栏\r\n        drawer_show_left: false, // 显示隐藏\r\n        info_left: { fff: \"5\" } // 左侧详情栏信息\r\n      },\r\n      // 查询字符串\r\n      search_str: \"\",\r\n\r\n      // 信息提示\r\n      info_tips: { itype: \"\" },\r\n\r\n      //顶部导航\r\n      navbar:[\r\n        {index:'/tablebasedata-gqxx',url1:'@/assets/image/u444.svg',url2:'@/assets/image/u448.svg',data:'基础数据'},\r\n        {index:'/',url1:'@/assets/image/u453.svg',url2:'@/assets/image/u457.svg',data:'信息服务'},\r\n        {index:'/tablezfkz-zfdd',url1:'@/assets/image/u462.svg',url2:'@/assets/image/u466.svg',data:'闸阀控制'},\r\n        {index:'/tabletest-test13',url1:'@/assets/image/u471.svg',url2:'@/assets/image/u475.svg',data:'值班管理'},\r\n        {index:'/tablexgpt-qxxx',url1:'@/assets/image/u480.svg',url2:'@/assets/image/u484.svg',data:'相关平台'},\r\n        {index:'/tableyjgl-yjfb',url1:'@/assets/image/u489.svg',url2:'@/assets/image/u493.svg',data:'预警管理'},\r\n        {index:'/tableldgl-ldjggl',url1:'@/assets/image/u498.svg',url2:'@/assets/image/u502.svg',data:'率定管理'},\r\n        {index:'/water-plan',url1:'@/assets/image/u507.svg',url2:'@/assets/image/u511.svg',data:'配水管理'},\r\n        {index:'/tablexxfw-yxgk',url1:'@/assets/image/u516.svg',url2:'@/assets/image/u520.svg',data:'维护管理'},\r\n        ],\r\n\r\n      system_info: null,\r\n      // 正在开发图层数据集合，其中包含图层对象\r\n      FeatrueLayers: [],\r\n      fList: [],\r\n      // 待开发的图层数据集合，其中包含图层对象\r\n      FeatrueLayers_waiting: [\r\n        {\r\n          title: \"墒情\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"蒸发量\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"地下水\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"地下水开采量\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"泵站\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"水质\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"潮位\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"泥沙\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"工情\",\r\n          show: \"0\"\r\n        },\r\n        {\r\n          title: \"气象\",\r\n          show: \"0\"\r\n        }\r\n      ],\r\n\r\n      FeatrueLayers_control: [\r\n        {\r\n          title: \"闸阀控制\",\r\n          show: \"0\",\r\n          iconUrl:require('@/assets/image/u28.svg')\r\n        }\r\n      ],\r\n      FL_Sel: [],\r\n      // 用于选中提示的图形图层\r\n      graphicsLayer_Selection: {\r\n        LayerObject: null,\r\n        graphics: []\r\n      },\r\n      // 图片放大模态框的走马灯对象\r\n      enlargeModal_carousel: {\r\n        Rows: [],\r\n        initial_index: 0,\r\n        initial_imgUrl: null,\r\n        arrow: \"always\",\r\n        autoplay: false,\r\n        indicator_position: \"inside\",\r\n        loop: true,\r\n        trigger: \"click\",\r\n        style: {\r\n          height: \"90%\"\r\n        },\r\n        show: true,\r\n        dialogVisible: false\r\n      },\r\n      // 消息窗口对象\r\n      Message_Window: {\r\n        // 预警信息\r\n        notify_info: {\r\n          // 列表\r\n          list: []\r\n        },\r\n        // 声音开关\r\n        Voice_Controller: true\r\n      },\r\n      // 消息窗口控制器对象\r\n      Message_Window_Controller: {\r\n        show: true\r\n      },\r\n      //折叠面板\r\n      activeNames: ['1'],\r\n      tool_box:true,\r\n      checkboxGroup1:['渠道水情','图像','闸阀水情'],\r\n      //底图选择\r\n      ditu_types:'topo',\r\n      isActive1:true,\r\n      isActive2:true,\r\n      loginform:{},\r\n      menus:[],\r\n      menus_data:{\r\n        jichu:false,\r\n        xinxi:false,\r\n        zhafa:false,\r\n        zhiban:false,\r\n        xiangguan:false,\r\n        yujin:false,\r\n        lvding:false,\r\n        peishui:false,\r\n        weihu:false,\r\n      },\r\n    }; \r\n  },\r\n  mixins: [FilterMethods, GetDataMethods],\r\n\r\n\r\n\r\n  //////////////////////////////////////\r\n  components: {\r\n    Table, // 表格\r\n    BaseBoxQUDAO, DetailQUDAO,// 渠道\r\n    BaseBoxZHAFASHUIQING, DetailZHAFASHUIQING,// 闸阀水情\r\n    BaseBoxZHAFAZHUANGTAI, DetailZHAFAZHUANGTAI,// 闸阀状态\r\n    BaseBoxYUQING, DetailYUQING,// 雨情\r\n    BaseBoxHEDAOSHUIQING, DetailHEDAOSHUIQING,// 河道水情\r\n    BaseBoxSHUIKUSHUIQING, DetailSHUIKUSHUIQING,// 水库水情\r\n    DetailSHIPINZHAN, BaseBoxSHIPINZHAN,// 视频站\r\n    DetailTUXIANGZHAN, BaseBoxTUXIANGZHAN,// 图像站\r\n    BaseBoxYUNXINGGONGKUANG, DetailYUNXINGGONGKUANG,// 运行工况\r\n    DetailSHUIWEIKURONG// 水位库容\r\n  },\r\n\r\n  //////////////////////////////////////\r\n  mounted() {\r\n    //加载地图\r\n    loadModules([\"esri/map\", \"esri/layers/GraphicsLayer\", \"esri/SpatialReference\", \"esri/symbols/TextSymbol\"], options)\r\n      .then(([Map]) => {\r\n        this.map = new esri.Map(\"map\", {\r\n          //basemap: \"satellite\",\r\n          basemap: \"topo\",\r\n          center: [112.393, 28.240],\r\n          zoom: 13,\r\n          logo: false,\r\n          fadeOnZoom: true,\r\n          slider: true // 伸缩滑块\r\n          // maxZoom:4, //最大空间等级\r\n          // minZoom:5, //最小空间等级\r\n          // navigationMode: 'css-transforms' // 调整或缩放地图平滑\r\n        });\r\n\r\n        this.map.on(\"click\", function(ev) {\r\n            var lat = Math.round(ev.mapPoint.getLatitude() * 1000) / 1000;\r\n            var lon = Math.round(ev.mapPoint.getLongitude() * 1000) / 1000;\r\n            console.log(\"当前坐标：\"+lat+\",\"+lon);\r\n        });\r\n\r\n        // 设置地图的鼠标样式\r\n        this.map.setMapCursor(\"pointer\");\r\n\r\n        //加载图层\r\n        //this.addSHPlayerToMap();\r\n        this.loadSHP();\r\n\r\n        //获取要素图层数据\r\n        // this.getAll();\r\n\r\n\r\n        this.add_GraphicsLayer_Selection_ToMap();\r\n        \r\n        \r\n      })\r\n      .catch(err => {\r\n        console.error(err);\r\n      });\r\n    Vue.prototype.$App = this;\r\n    this.axios.get('/guanqu/web/users/online-user').then((res) => {\r\n        this.loginform = res.data;\r\n    });\r\n    this.axios.get('/guanqu/web/users/online-user/menus').then((res) => {\r\n        this.menus = res.data;\r\n        this.menus.forEach((item)=>{\r\n            if (item.label == '基础数据') {\r\n              this.menus_data.jichu = true;\r\n            }\r\n            if (item.label == '信息服务') {\r\n              this.menus_data.xinxi = true;\r\n            }\r\n            if (item.label == '闸阀控制') {\r\n              this.menus_data.zhafa = true;\r\n            }\r\n            if (item.label == '值班管理') {\r\n              this.menus_data.zhiban = true;\r\n            }\r\n            if (item.label == '相关平台') {\r\n              this.menus_data.xiangguan = true;\r\n            }\r\n            if (item.label == '预警管理') {\r\n              this.menus_data.yujin = true;\r\n            }\r\n            if (item.label == '率定管理') {\r\n              this.menus_data.lvding = true;\r\n            }\r\n            if (item.label == '配水管理') {\r\n              this.menus_data.peishui = true;\r\n            }\r\n            if (item.label == '维护管理') {\r\n              this.menus_data.weihu = true;\r\n            }\r\n        })\r\n    });\r\n  },\r\n\r\n\r\n\r\n\r\n\r\n  methods: {\r\n    //关闭页面\r\n    close(){\r\n      this.axios.delete('/guanqu/web/user/logout').then((res)=>{\r\n        console.log(res);\r\n        window.location.href = 'http://222.240.238.58:7001/static/main/#/';\r\n      });\r\n      \r\n    },\r\n    //监测显示全部\r\n    jcxs(){\r\n      if (this.FeatrueLayers.length>10) {\r\n        this.isActive1 = !this.isActive1;\r\n      }else{\r\n        this.isActive1 = this.isActive1;\r\n      }\r\n    },\r\n    //图层显示全部\r\n    tcxs(){\r\n      if (this.tu_ceng_list.length>5) {\r\n        this.isActive2 = !this.isActive2;\r\n      }else{\r\n        this.isActive2 = this.isActive2;\r\n      }\r\n    },\r\n    //放大地图按钮\r\n    fangda(){ \r\n      $(\".esriSimpleSliderIncrementButton\").click();\r\n    },\r\n    //缩小地图按钮\r\n    suoxiao(){\r\n      $(\".esriSimpleSliderDecrementButton\").click();\r\n    },\r\n\r\n\r\n\r\n    //图层关闭或打开\r\n    //koen 20190911\r\n    tu_ceng_switch(item) {\r\n      console.log(item);\r\n      item.show = !item.show;\r\n      if(item.show) item.layer.show();\r\n      else item.layer.hide();\r\n    },\r\n\r\n    //切换底图（卫星、街道...）\r\n    dituchange1(){\r\n      this.ditu_types = '-';\r\n      var id = this.map.basemapLayerIds[0];\r\n      if(this.ditu_types == '-') return this.map.getLayer(id).setVisibility(false);\r\n      else this.map.getLayer(id).setVisibility(true);\r\n      this.map.setBasemap(this.ditu_types);\r\n    },\r\n    dituchange2(){\r\n      this.ditu_types = 'satellite';\r\n      var id = this.map.basemapLayerIds[0];\r\n      if(this.ditu_types == '-') return this.map.getLayer(id).setVisibility(false);\r\n      else this.map.getLayer(id).setVisibility(true);\r\n      this.map.setBasemap(this.ditu_types);\r\n    },\r\n    dituchange3(){\r\n      this.ditu_types = 'hybrid';\r\n      var id = this.map.basemapLayerIds[0];\r\n      if(this.ditu_types == '-') return this.map.getLayer(id).setVisibility(false);\r\n      else this.map.getLayer(id).setVisibility(true);\r\n      this.map.setBasemap(this.ditu_types);\r\n    },\r\n    dituchange4(){\r\n      this.ditu_types = 'streets';\r\n      var id = this.map.basemapLayerIds[0];\r\n      if(this.ditu_types == '-') return this.map.getLayer(id).setVisibility(false);\r\n      else this.map.getLayer(id).setVisibility(true);\r\n      this.map.setBasemap(this.ditu_types);\r\n    },\r\n    dituchange5(){\r\n      this.ditu_types = 'topo';\r\n      var id = this.map.basemapLayerIds[0];\r\n      if(this.ditu_types == '-') return this.map.getLayer(id).setVisibility(false);\r\n      else this.map.getLayer(id).setVisibility(true);\r\n      this.map.setBasemap(this.ditu_types);\r\n    },\r\n    ditu_change() {\r\n      var id = this.map.basemapLayerIds[0];\r\n      if(this.ditu_type == '-') return this.map.getLayer(id).setVisibility(false);\r\n      else this.map.getLayer(id).setVisibility(true);\r\n      this.map.setBasemap(this.ditu_type);\r\n    },\r\n\r\n\r\n    //koen 20190930\r\n    //转换坐标系\r\n    zuobiaoxi(item) {\r\n      console.log('处理坐标');\r\n      console.log(item);\r\n\r\n      item.Rows.forEach((one, index) => {\r\n        //获取坐标\r\n        var x=Number(one.geometry.x);\r\n        var y=Number(one.geometry.y);\r\n\r\n        //如果basemap使用ArcGIS的就需要\r\n        //转换坐标系\r\n        x = (x / 180.0) * 20037508.34\r\n        if (y > 85.05112) y = 85.05112;\r\n        if (y < -85.05112) y = -85.05112;\r\n        y = (Math.PI / 180.0) * y;\r\n        var tmp = Math.PI / 4.0 + y / 2.0;\r\n        y = 20037508.34 * Math.log(Math.tan(tmp)) / Math.PI;\r\n\r\n        item.Rows[index].attributes.LGTD = x;\r\n        item.Rows[index].attributes.LTTD = y;\r\n        item.Rows[index].geometry.x = x;\r\n        item.Rows[index].geometry.y = y;\r\n      });\r\n\r\n\r\n      return item;\r\n    },\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    //保存原图方法\r\n    handleClose(done) {\r\n      this.enlargeModal_carousel.dialogVisible = false;\r\n      return;\r\n      // this.$confirm(\"明白了！\")\r\n      //   .then(_ => {\r\n      //     done();\r\n      //   })\r\n      //   .catch(_ => {});\r\n    },\r\n    // 开关切换时的操作\r\n    switch2change(){\r\n      console.log(this.mapBox3D);\r\n      if (this.mapBox3D) {\r\n        window.location.href=\"http://222.240.238.58:7001/static/demo-guanqu-lcs-3d/#/\"\r\n      }\r\n    },\r\n    switchchange() {\r\n      // if (this.mapBox_show == \"0\") {\r\n      //   this.$router.push(\"/\");\r\n      // }\r\n      // if (this.mapBox_show == \"1\") {\r\n      //   this.$router.push(\"/\");\r\n      // }\r\n    },\r\n    // 当选择的监控图层发生变化\r\n    // 重新显示或隐藏部分图层\r\n    OnLayerChange(item) {\r\n      if (item.show=='0') {\r\n        item.show='1';\r\n      }else if (item.show=='1') {\r\n        item.show='0';\r\n      }\r\n      var featrueLayers = this.FeatrueLayers;\r\n      featrueLayers.forEach((v, index) => {\r\n        if (v.show == \"1\") v.LayerObject.show();\r\n        else {\r\n          v.LayerObject.hide();\r\n          v.LayerObject_yujing.hide();\r\n          if (this.FeatrueLayers[index].TextGraphicsLayerController) {\r\n            this.FeatrueLayers[\r\n              index\r\n            ].TextGraphicsLayerController.removeAllTextGraphicsLayer();\r\n          }\r\n        }\r\n      });\r\n      // 获取正在显示的图层\r\n      var featrueLayers_showing = this.featrueLayers_showing();\r\n      // 如果存在 显示的图层\r\n      if (featrueLayers_showing.length != 0) {\r\n        // 如果要隐藏图层 并且 隐藏的图层是当前显示的图层的时候\r\n        if (item.show == 0 && item.itype == this.listWindow.activeName) {\r\n          // 激活的baseBox为正在显示的图层中的最后一个\r\n          this.listWindow.activeName =\r\n            featrueLayers_showing[featrueLayers_showing.length - 1].itype;\r\n        } else if (item.show == 1) {\r\n          // 如果要显示图层 并且 当前没有显示的图层的时候\r\n          // 激活的baseBox为要显示的图层\r\n          this.listWindow.activeName = item.itype;\r\n          if (featrueLayers_showing.length == 1) {\r\n            // 列表窗显示\r\n            this.listWindow_show();\r\n          }\r\n        }\r\n      } else {\r\n        // 列表窗隐藏\r\n        this.listWindow_hide();\r\n      }\r\n    },\r\n\r\n    // 加载底图\r\n    loadSHP() {\r\n      this.axios.get(\"/static/demo-hunanguanqu/ditu.json\").then(res => {\r\n        var data = res.data,\r\n        list = data.shpList;\r\n        console.warn(\"res\", res);\r\n        console.warn(\"list\", list);\r\n        if (list.length <= 0) return;\r\n\r\n\r\n          list.forEach((val, index) => {\r\n            var data = val.data;\r\n            var features = data.features;\r\n            var color = val.color;\r\n            var size = val.size || 2;\r\n            console.warn(\"data\", data);\r\n\r\n            var graphicsSHPlayer = new esri.layers.GraphicsLayer();\r\n            this.map.addLayer(graphicsSHPlayer);\r\n\r\n            for (var j = 0; j < features.length; j++) {\r\n              var feature = features[j];\r\n              var graphic = null;\r\n\r\n              switch (feature.geometry.type) {\r\n                //点\r\n                case \"Point\":\r\n                  //symbol = new esri.symbol.PictureMarkerSymbol(getRootPath() + \"images/point1.png\", 22, 27);\r\n                  symbol = new esri.symbol.SimpleMarkerSymbol({\r\n                    size: size,\r\n                    style: \"simplefillsymbol\"\r\n                  });\r\n                  symbol.setColor(color);\r\n                  var mappoint = new esri.geometry.Point(\r\n                    feature.geometry.coordinates[0],\r\n                    feature.geometry.coordinates[1],\r\n                    new esri.SpatialReference({ wkid: 4326 })\r\n                  );\r\n                  graphic = new esri.Graphic(mappoint, symbol);\r\n\r\n\r\n                  var mappoint_text = new esri.geometry.Point(\r\n                    feature.geometry.coordinates[0],\r\n                    feature.geometry.coordinates[1],\r\n                    new esri.SpatialReference({ wkid: 4326 })\r\n                  );\r\n                  var textsymbol = new esri.symbol.TextSymbol(feature.properties.NM);\r\n                  textsymbol.setFont(new esri.symbol.Font(\"8pt\").setWeight(esri.symbol.Font.WEIGHT_BOLD).setFamily(\"Arial\"));\r\n                  textsymbol.setOffset(0, 30);\r\n                  textsymbol.setColor(new esri.Color([0,0,0]));\r\n                  var graphic_text = new esri.Graphic(mappoint_text, textsymbol);\r\n                  if(graphic_text) graphicsSHPlayer.add(graphic_text);\r\n\r\n                  break;\r\n                //线\r\n                case \"LineString\":\r\n                  symbol = new esri.symbol.SimpleLineSymbol(\r\n                    esri.symbol.SimpleLineSymbol.STYLE_SOLID,\r\n                    new dojo.Color(color),\r\n                    size\r\n                  );\r\n                  var polyline = new esri.geometry.Polyline(\r\n                    feature.geometry.coordinates\r\n                  );\r\n                  graphic = new esri.Graphic(polyline, symbol);\r\n                  break;\r\n                //线\r\n                case \"MultiLineString\":\r\n                  var symbol = new esri.symbol.SimpleLineSymbol(\r\n                    esri.symbol.SimpleLineSymbol.STYLE_SOLID,\r\n                    new dojo.Color(color),\r\n                    size\r\n                  );\r\n                  var polyline = new esri.geometry.Polyline(\r\n                    feature.geometry.coordinates\r\n                  );\r\n                  var graphic = new esri.Graphic(polyline, symbol);\r\n                  break;\r\n                //面\r\n                case \"Polygon\":\r\n                  symbol = new esri.symbol.SimpleFillSymbol(\r\n                    esri.symbol.SimpleFillSymbol.STYLE_SOLID,\r\n                    new esri.symbol.SimpleLineSymbol(\r\n                      esri.symbol.SimpleLineSymbol.STYLE_SOLID,\r\n                      new esri.Color([211, 211, 211]),\r\n                      1\r\n                    ),\r\n                    new esri.Color(color)\r\n                  );\r\n                  var polygon = new esri.geometry.Polygon(\r\n                    feature.geometry.coordinates\r\n                  );\r\n                  graphic = new esri.Graphic(polygon, symbol);\r\n                  break;\r\n              }\r\n\r\n              graphicsSHPlayer.add(graphic);\r\n            }\r\n\r\n            console.log(\"graphicsSHPlayer\", graphicsSHPlayer);\r\n            this.tu_ceng_list.push({name:val.name, show:val.show, layer:graphicsSHPlayer,icon:val.icon,icon_active:val.icon_active});\r\n            if (val.show==false) {\r\n              graphicsSHPlayer.hide();\r\n            }else{\r\n              graphicsSHPlayer.show();\r\n            }\r\n          });\r\n          this.getAll();\r\n      });\r\n    },\r\n\r\n\r\n    //设置地图初始范围\r\n    setMapExtent(options) {\r\n      var initExtent = new esri.geometry.Extent(options);\r\n\r\n      this.map.setExtent(initExtent);  //koen 会出现中心点在太平洋上的bug\r\n      //木木  但是没有这个函数黄材这边就没办法初始化定位了\r\n    },\r\n    //获取各个图层信息\r\n    getEachFeatureLayers(FeatureLayers) {\r\n      for (let i = 0; i < FeatureLayers.length; i++) {\r\n        // 获取图层数据（没有过滤条件的）\r\n        this.getFeatrueLayerWithoutPreconditions(FeatureLayers[i].url, res => {\r\n          var featureLayerOBJ = FeatureLayers[i];\r\n\r\n          var data = res.data;\r\n          var clone_data = JSON.parse(JSON.stringify(data));\r\n\r\n          // 创建图层（根据图层数据）\r\n          var featureLayer = this.createFeatrueLayer(data);\r\n          // 获取异常数据\r\n          var AbnormalData = this.getAbnormalData(data);\r\n          // 创建预警图层（根据图层异常数据）\r\n          var featrueLayer_yujing = this.createFeatrueLayer(AbnormalData);\r\n\r\n          //设置图层的特征点图标\r\n          this.setFeatrueLayerSymbol(featureLayer, featureLayerOBJ.icon, { width: 16, height: 16});\r\n\r\n          // 设置预警图层的特征点图标\r\n          this.setFeatrueLayerSymbol( featrueLayer_yujing, \"/static/demo-hunanguanqu/yujing.gif\", { width: 42, height: 42 } );\r\n\r\n          console.log(\"@@@@@@@@@@@@@@@@@@\", featureLayerOBJ);\r\n\r\n          // 默认显示闸阀水情 和 渠道水情图层\r\n          if (\r\n            featureLayerOBJ.itype === \"qudaoshuiqing\" ||\r\n            featureLayerOBJ.itype === \"zhafashuiqing\" ||\r\n            featureLayerOBJ.itype === \"tuxiang\"\r\n          ) {\r\n            featureLayerOBJ.show = \"1\";\r\n          }\r\n          if (featureLayerOBJ.show != \"1\") {\r\n            featrueLayer_yujing.hide();\r\n            featureLayer.hide();\r\n          } // 根据数据里面的show属性 决定图层是否隐藏\r\n          let obj = {\r\n            title: JSON.parse(JSON.stringify(featureLayerOBJ)).title,\r\n            show: JSON.parse(JSON.stringify(featureLayerOBJ)).show\r\n          };\r\n\r\n          // this.fList.push(obj)\r\n          // 给图层对象添加 图层，图层特征点数据，地图\r\n          featureLayerOBJ.LayerObject = featureLayer; // 添加图层到图层对象\r\n          featureLayerOBJ.LayerObject_yujing = featrueLayer_yujing; // 添加图层到图层对象\r\n          featureLayerOBJ.Rows = clone_data.features; // 添加图层特征点数据到图层对象\r\n          featureLayerOBJ.map = this.map; // 添加地图到图层对象\r\n\r\n          // 添加图层模块\r\n          this.addFeatrueLayer(\r\n            [featrueLayer_yujing, featureLayer],\r\n            featureLayerOBJ\r\n          );\r\n\r\n          // 给图层里的特征点 添加事件\r\n          this.addEventToJsonFlayer(featureLayer, featureLayerOBJ);\r\n        });\r\n      }\r\n    },\r\n    // 获取系统信息\r\n    getAll() {\r\n      // /static/demo-hunanguanqu/system.json\r\n      this.axios.get(\"/guanqu/gis/system_info\").then(res => {\r\n        var data = res.data;\r\n        // 保存系统信息到system_info\r\n        this.system_info = data;\r\n        // 保存各图层url配置到system_info的FLayerUrl里\r\n        this.system_info.FLayerUrl = (() => {\r\n          var FeatureLayers = this.system_info.FeatureLayers;\r\n          var FLayerUrl = new Object();\r\n\r\n          FeatureLayers.forEach((val, index) => {\r\n            FLayerUrl[val.itype] = val.url;\r\n          });\r\n          return FLayerUrl;\r\n        })();\r\n        // 设置地图 视图初始范围\r\n        var GIS_CENTER = data.GIS_CENTER;\r\n        this.setMapExtent({\r\n\r\n          xmin: parseFloat(GIS_CENTER.xmin),\r\n          xmax: parseFloat(GIS_CENTER.xmax),\r\n\r\n          ymin: parseFloat(GIS_CENTER.ymin),\r\n          ymax: parseFloat(GIS_CENTER.ymax),\r\n\r\n          spatialReference: {wkid: 4326}\r\n          //spatialReference: this.map.spatialReference\r\n          //spatialReference: new esri.SpatialReference({ wkid: 4326 })\r\n        });\r\n        // 获取各个图层信息\r\n        this.getEachFeatureLayers(data.FeatureLayers);\r\n      });\r\n    },\r\n    // 给特征点元素点添加事件\r\n    addEventToJsonFlayer(JsonFlayer, v) {\r\n      JsonFlayer.on(\"click\", evt => {\r\n        //当鼠标点击元素\r\n        // 抽屉组件默认显示表类型\r\n        evt.graphic.attributes.rowinfo.tableType = {\r\n          qdsq: \"historyTable\",\r\n          zfsq: \"historyTable\",\r\n          hdsq: \"historyTable\",\r\n          yq: \"hourTable\",\r\n          sksq: \"historyTable\"\r\n        };\r\n        // 展示抽屉组件\r\n        this.showDrawer(evt, v);\r\n      });\r\n    },\r\n    // 获取 子组件传过来 的绘图方法\r\n    chart(item) {\r\n      this.getChart = item.chart;\r\n    },\r\n    // 展示抽屉组件\r\n    showDrawer(evt, v) {\r\n      var graphic = evt.graphic;\r\n\r\n      var show_right = () => {\r\n        this.details.info_right = graphic.attributes;\r\n        this.details.info_right.itype = v.itype;\r\n        this.details.drawer_show_right = true;\r\n      };\r\n\r\n      // 如果左边抽屉组件显示，显示或替换右边抽屉组件\r\n      if (this.details.drawer_show_left) {\r\n        if (this.details.info_left.STCD == graphic.attributes.STCD) {\r\n          // 如果打开的站点相同\r\n          return this.$Message.warning(\"该站点详情已打开\");\r\n        }\r\n        // 传递属性数据\r\n\r\n        // 对应类型\r\n        if (this.details.drawer_show_right) {\r\n          this.details.drawer_show_right = false;\r\n          this.details.info_right.itype = false;\r\n          setTimeout(() => {\r\n            show_right();\r\n          }, 300);\r\n        } else {\r\n          show_right();\r\n        }\r\n      } else {\r\n        // 否则 显示左边抽屉组件\r\n        // 传递属性数据\r\n        console.log(graphic.attributes);\r\n        this.details.info_left = graphic.attributes;\r\n        // 对应类型\r\n        console.log(v.itype);\r\n        this.details.info_left.itype = v.itype;\r\n        this.details.drawer_show_left = true;\r\n      }\r\n      console.log(evt, v);\r\n    },\r\n    // 关闭抽屉组件\r\n    closeDrawer(placement) {\r\n      // 如果关闭的是左抽屉，并且右抽屉未开启\r\n      if (placement == \"left\" && !this.details.drawer_show_right) {\r\n        this.GraphicsLayer_Selection_clear(); // 取消所有站点的闪烁\r\n      }\r\n\r\n      // 如果关闭的是右抽屉，并且左抽屉未开启\r\n      if (placement == \"right\" && !this.details.drawer_show_left) {\r\n        this.GraphicsLayer_Selection_clear(); // 取消所有站点的闪烁\r\n      }\r\n      // 如果关闭的是右抽屉，并且左抽屉已开启\r\n      if (placement == \"right\" && this.details.drawer_show_left) {\r\n        // 设置中心缩放\r\n        //this.setMapCenterandZoom(this.details.info_left.LGTD,this.details.info_left.LTTD);\r\n        // 取消所有站点的闪烁\r\n        this.GraphicsLayer_Selection_clear();\r\n        // 对应站点闪烁\r\n        this.add_Graphic_To_GraphicsLayer_Selection(this.details.info_left);\r\n      }\r\n\r\n      this.details[`info_${placement}`].itype = null;\r\n    },\r\n    // 设置中心和缩放 (接受经纬度，和缩放比例)\r\n    setMapCenterandZoom(LGTD, LTTD, Zoom) {\r\n      this.map.centerAndZoom([Number(LGTD), Number(LTTD)], Zoom || 1);\r\n    },\r\n    // 处理标签页点击事件\r\n    handleTabClick(item) {},\r\n    // 声音提示\r\n    baiduVoice(str, boolean) {\r\n      //调用百度接口----------------总感觉声音怪怪的\r\n      var url =\r\n        \"http://tts.baidu.com/text2audio?lan=zh&ie=UTF-8&text=\" +\r\n        encodeURI(str);\r\n      var n = new Audio(url);\r\n      n.src = url;\r\n      if (boolean) {\r\n        n.play();\r\n      }\r\n      // n.pause();\r\n\r\n      return n;\r\n    },\r\n    // 正在显示的图层\r\n    featrueLayers_showing() {\r\n      var featrueLayers = this.FeatrueLayers;\r\n      // 获取正在显示的图层\r\n      var featrueLayers_showing = featrueLayers.filter(val => {\r\n        if (val.show == 1) {\r\n          return true;\r\n        }\r\n      });\r\n      return featrueLayers_showing;\r\n    },\r\n    // 列表窗显示隐藏切换(控制面板)\r\n    listWindow_toggle() {\r\n      this.listWindow.show_Controller = !this.listWindow.show_Controller;\r\n    },\r\n    // 列表窗显示\r\n    listWindow_show() {\r\n      this.listWindow.show_Controller = true;\r\n    },\r\n    // 列表窗隐藏\r\n    listWindow_hide() {\r\n      this.listWindow.show_Controller = false;\r\n    },\r\n    // 列表窗形态切换\r\n    listWindow_changeMode() {\r\n      var mode = this.listWindow.mode;\r\n\r\n      if (mode < 3) {\r\n        this.listWindow.mode++;\r\n        return console.log(this.listWindow.mode);\r\n      }\r\n\r\n      this.listWindow.mode = 0;\r\n    },\r\n    // 列表选项卡位置\r\n    listWindow_tabPosition(mode) {\r\n      switch (mode) {\r\n        case 0:\r\n          return \"top\";\r\n        case 1:\r\n          return \"right\";\r\n        case 2:\r\n          return \"left\";\r\n        case 3:\r\n          return \"bottom\";\r\n        default:\r\n          return \"top\";\r\n      }\r\n    },\r\n    // 所有audio标签声音关闭\r\n    audio_pause() {\r\n      var audio_eles = document.getElementsByClassName(\"baiduVoice\");\r\n      for (let index = 0; index < audio_eles.length; index++) {\r\n        var ele = audio_eles[index];\r\n        if (ele !== null) {\r\n          ele.pause(); // 这个就是暂停\r\n          //检测播放是否已暂停.audio.paused 在播放器播放时返回false.\r\n          // alert(audio.paused);\r\n          // if (audio_ele.paused) {\r\n          //   audio.play(); //audio.play();// 这个就是播放\r\n          // } else {\r\n          //   audio_ele.pause(); // 这个就是暂停\r\n          // }\r\n        }\r\n      }\r\n    },\r\n    // 移除选项卡\r\n    removeTab(item) {\r\n      var featrueLayers = this.FeatrueLayers;\r\n      featrueLayers.forEach((val, index) => {\r\n        if (val.itype == item) {\r\n          this.FeatrueLayers[index].show = 0;\r\n          val.LayerObject.hide();\r\n          val.LayerObject_yujing.hide();\r\n\r\n          // 所有audio标签声音关闭\r\n          this.audio_pause();\r\n\r\n          if (this.FeatrueLayers[index].TextGraphicsLayerController) {\r\n            this.FeatrueLayers[\r\n              index\r\n            ].TextGraphicsLayerController.removeAllTextGraphicsLayer();\r\n          }\r\n        }\r\n      });\r\n      // 获取正在显示的图层\r\n      var featrueLayers_showing = this.featrueLayers_showing();\r\n      if (featrueLayers_showing != 0) {\r\n        // 激活的baseBox为正在显示的图层中的最后一个\r\n        this.listWindow.activeName =\r\n          featrueLayers_showing[featrueLayers_showing.length - 1].itype;\r\n      } else {\r\n        // 列表窗隐藏\r\n        this.listWindow_hide();\r\n      }\r\n    },\r\n    // 还原地图视图默认位置\r\n    restoreMapView() {\r\n      var system_info = this.system_info,\r\n        GIS_CENTER = system_info.GIS_CENTER;\r\n        console.log();\r\n      // 设置地图 视图初始范围\r\n      this.setMapExtent({\r\n        // xmin: 110.97802432948647,\r\n        // ymin: 27.531235202509322,parseFloat\r\n        // xmax: 113.8843752444488,\r\n        // ymax: 28.9647322423371,\r\n        xmin: parseFloat(GIS_CENTER.xmin),\r\n        xmax: parseFloat(GIS_CENTER.xmax),\r\n        ymin: parseFloat(GIS_CENTER.ymin),\r\n        ymax: parseFloat(GIS_CENTER.ymax),\r\n        spatialReference: this.map.spatialReference\r\n      });\r\n      this.map.infoWindow.hide();\r\n    },\r\n    // 获取异常数据\r\n    getAbnormalData(graphicsData) {\r\n      var data = JSON.parse(JSON.stringify(graphicsData)); // 图层数据深拷贝\r\n      // 把每个特征点的rowinfo数据放入每个特征点的属性中\r\n      data.features.forEach((val, index) => {\r\n        data.features[index].attributes.rowinfo = data.features[index].rowinfo;\r\n      });\r\n\r\n      var AbnormalData = data.features.filter((val, index) => {\r\n        if (val.rowinfo._status == 0) {\r\n          return true;\r\n        }\r\n      });\r\n\r\n      data.features = AbnormalData;\r\n\r\n      return data;\r\n    },\r\n    // 通知\r\n    notify_Layer(options, data) {\r\n      if (data.length > 0) {\r\n        this.Message_Window_show(true); // 打开消息窗口\r\n\r\n        var Voice_Controller = this.Message_Window.Voice_Controller,\r\n          notify_info_list = this.Message_Window.notify_info.list;\r\n\r\n        var time = 0;\r\n        data.forEach((val, index, array) => {\r\n          var rowinfo = val.rowinfo;\r\n\r\n          var item = new Object();\r\n          item.icon = options.icon;\r\n          item.text = `${rowinfo.STNM} 出现异常`;\r\n          item.voice = this.baiduVoice(item.text);\r\n          item.voice_duration = item.text.length * 300;\r\n          item.id = notify_info_list.length;\r\n          notify_info_list.length = 0;\r\n          notify_info_list.unshift(item);\r\n\r\n          setTimeout(() => {\r\n            if (Voice_Controller) {\r\n              var duration = notify_info_list[index].voice.duration;\r\n              time += duration * 1000;\r\n              var copyTime = JSON.parse(JSON.stringify(time));\r\n              setTimeout(() => {\r\n                var voice = this.Message_Window.notify_info.list[index].voice;\r\n                if (voice) {\r\n                  voice.play();\r\n                }\r\n              }, copyTime);\r\n            }\r\n          }, 500);\r\n        });\r\n      }\r\n    },\r\n    // 声音列表播放\r\n    voice_list_play(list) {\r\n      var time = 0;\r\n      list.forEach((val, index) => {\r\n        var voice = val.voice,\r\n          voice_duration = val.voice_duration;\r\n        time += voice_duration;\r\n        console.log(\"voice\", voice);\r\n        var copyTime = JSON.parse(JSON.stringify(time));\r\n        setTimeout(() => {\r\n          voice.play();\r\n        }, copyTime);\r\n      });\r\n    },\r\n    // 声音列表播放\r\n    voice_list_pause(list) {\r\n      var list = list || this.Message_Window.notify_info.list;\r\n      list.forEach((val, index) => {\r\n        list[index].voice = null;\r\n      });\r\n    },\r\n    // 查询图层 (要查询的图层类型, 过滤字段, 所属图层对象)\r\n    search_FeatrueLayer(type, fields, featureLayerOBJ, callback, errCallback) {\r\n      // 获取具有过滤条件的图层数据\r\n      this.getFeatrueLayer(\r\n        type,\r\n        fields,\r\n        res => {\r\n          var clone_data = JSON.parse(JSON.stringify(res.data));\r\n          // 创建图层（根据图层数据）\r\n          var featrueLayer = this.createFeatrueLayer(res.data);\r\n          // 获取异常数据\r\n          var AbnormalData = this.getAbnormalData(res.data);\r\n          // 创建预警图层（根据图层异常数据）\r\n          var featrueLayer_yujing = this.createFeatrueLayer(AbnormalData);\r\n          // 移除图层对象里的相应图层\r\n          this.removeFeatureLayer(featureLayerOBJ);\r\n          // 移除图层对象里的相应预警图层\r\n          this.removeFeatureLayer_yujing(featureLayerOBJ);\r\n          // 设置图层的特征点图标\r\n          this.setFeatrueLayerSymbol(featrueLayer, featureLayerOBJ.icon, {\r\n            width: 16,\r\n            height: 16\r\n          });\r\n\r\n          // 设置预警图层的特征点图标\r\n          this.setFeatrueLayerSymbol(\r\n            featrueLayer_yujing,\r\n            \"/static/demo-hunanguanqu/yujing.gif\",\r\n            {\r\n              width: 46,\r\n              height: 46\r\n            }\r\n          );\r\n\r\n          // 添加预警图层到地图\r\n          this.addFeatrueLayerToMap(featrueLayer_yujing);\r\n          // 添加图层到地图\r\n          this.addFeatrueLayerToMap(featrueLayer);\r\n\r\n          if (AbnormalData.features.length > 0) {\r\n            // 图层提示预警信息\r\n            this.notify_Layer(\r\n              {\r\n                icon: featureLayerOBJ.icon_warning,\r\n                type: \"warning\"\r\n              },\r\n              AbnormalData.features\r\n            );\r\n          }\r\n\r\n          // 更新图层对象集合里面 对应图层对象的 图层以及图层数据\r\n          var newFeatureLayerOBJ = this.updateFeatrueLayers(\r\n            featureLayerOBJ,\r\n            featrueLayer,\r\n            featrueLayer_yujing,\r\n            clone_data\r\n          );\r\n          // 如果有回调，执行回调\r\n          if (typeof callback == \"function\") {\r\n            callback(newFeatureLayerOBJ);\r\n          }\r\n          // 取消所有站点的闪烁\r\n          this.GraphicsLayer_Selection_clear();\r\n          // 给图层里的特征点 添加事件\r\n          this.addEventToJsonFlayer(\r\n            newFeatureLayerOBJ.LayerObject,\r\n            newFeatureLayerOBJ\r\n          );\r\n        }\r\n        // errCallback\r\n      );\r\n    },\r\n    // 获取没有过滤条件的图层数据\r\n    getFeatrueLayerWithoutPreconditions(url, callback) {\r\n      this.axios.get(url).then(res => {\r\n        if (typeof callback == \"function\") {\r\n          callback(res);\r\n        }\r\n      });\r\n    },\r\n    // 获取具有过滤条件的图层数据\r\n    getFeatrueLayer(type, fields, callback, errCallback) {\r\n      /*\r\n                type为数字，以下为不同数字对应图层\r\n                4: 渠道水情\r\n                5: 闸阀水情\r\n                6: 闸阀状态\r\n                7: 图像\r\n                8: 视频\r\n                */\r\n\r\n      var url = this.system_info.FLayerUrl[type];\r\n\r\n      var body = {\r\n        // _filter: new Object()\r\n      };\r\n      // 增加过滤字段\r\n      for (var key in fields) {\r\n        body[key] = fields[key];\r\n      }\r\n\r\n      this.axios.post(url, body).then(res => {\r\n        if (typeof errCallback == \"function\") {\r\n          errCallback();\r\n        }\r\n        if (typeof callback == \"function\") {\r\n          callback(res);\r\n        }\r\n      });\r\n\r\n    },\r\n    // 移除指定图层\r\n    removeFeatureLayer(featureLayerOBJ) {\r\n      // 从地图中移除图层\r\n      if (featureLayerOBJ.LayerObject) {\r\n        this.map.removeLayer(featureLayerOBJ.LayerObject);\r\n      }\r\n\r\n      // 从控制面板的图层对象中清空图层及图层特征点数据\r\n      featureLayerOBJ.LayerObject = null;\r\n      featureLayerOBJ.Rows = [];\r\n    },\r\n    // 移除指定图层的预警图层\r\n    removeFeatureLayer_yujing(featureLayerOBJ) {\r\n      // 从地图中移除图层\r\n      if (featureLayerOBJ.LayerObject_yujing) {\r\n        this.map.removeLayer(featureLayerOBJ.LayerObject_yujing);\r\n      }\r\n      // 从控制面板的图层对象中清空图层及图层特征点数据\r\n      featureLayerOBJ.LayerObject_yujing = null;\r\n      // featureLayerOBJ.Rows = [];\r\n    },\r\n    // 创建图层（根据图层数据）\r\n    createFeatrueLayer(graphicsData) {\r\n      var data = JSON.parse(JSON.stringify(graphicsData)); // 图层数据深拷贝\r\n      // 把每个特征点的rowinfo数据放入每个特征点的属性中\r\n      data.features.forEach((val, index) => {\r\n        data.features[index].attributes.rowinfo = data.features[index].rowinfo;\r\n      });\r\n\r\n      //构建图层\r\n      var featureCollection = {\r\n        layerDefinition: data,\r\n        featureSet: new esri.tasks.FeatureSet(data)\r\n      };\r\n\r\n      var featureLayer = new esri.layers.FeatureLayer(featureCollection);\r\n\r\n      return featureLayer;\r\n    },\r\n    // 设置图层的特征点图标\r\n    setFeatrueLayerSymbol(featureLayer, iconUrl, option) {\r\n      var symbol = new esri.symbol.PictureMarkerSymbol(\r\n        iconUrl,\r\n        option ? option.width : 16,\r\n        option ? option.height : 20\r\n      );\r\n      var renderer = new esri.renderer.SimpleRenderer(symbol);\r\n      featureLayer.setRenderer(renderer);\r\n    },\r\n    // 添加图层到地图\r\n    addFeatrueLayerToMap(featureLayer) {\r\n      this.map.addLayer(featureLayer);\r\n    },\r\n    // 添加图层对象到控制面板\r\n    addFeatrueLayerObjToBaseBox(featureLayerOBJ) {\r\n      // 排序\r\n      switch (featureLayerOBJ.title) {\r\n        case \"雨情\":\r\n          this.FeatrueLayers.splice(3, 0, featureLayerOBJ);\r\n          break;\r\n        case \"水库水情\":\r\n          this.FeatrueLayers.splice(4, 0, featureLayerOBJ);\r\n          break;\r\n        case \"河道水情\":\r\n          this.FeatrueLayers.splice(6, 0, featureLayerOBJ);\r\n          break;\r\n        case \"渠道水情\":\r\n          this.FeatrueLayers.splice(0, 0, featureLayerOBJ);\r\n          break;\r\n        case \"闸阀水情\":\r\n          this.FeatrueLayers.splice(1, 0, featureLayerOBJ);\r\n          break;\r\n        case \"闸阀状态\":\r\n          this.FeatrueLayers.splice(5, 0, featureLayerOBJ);\r\n          break;\r\n        case \"图像\":\r\n          this.FeatrueLayers.splice(2, 0, featureLayerOBJ);\r\n          break;\r\n        case \"视频\":\r\n          this.FeatrueLayers.splice(7, 0, featureLayerOBJ);\r\n          break;\r\n        case \"运行工况\":\r\n          this.FeatrueLayers.splice(8, 0, featureLayerOBJ);\r\n          break;\r\n      }\r\n    },\r\n    // 添加图层模块\r\n    addFeatrueLayer(featureLayerList, featureLayerOBJ) {\r\n      featureLayerList.forEach(val => {\r\n        // 添加图层到地图\r\n        this.addFeatrueLayerToMap(val);\r\n      });\r\n      // 添加图层对象到控制面板\r\n      this.addFeatrueLayerObjToBaseBox(featureLayerOBJ);\r\n    },\r\n    // 替换指定图层对象里的图层和特征点数据\r\n    updateFeatrueLayers(\r\n      featureLayerOBJ,\r\n      featureLayer,\r\n      featrueLayer_yujing,\r\n      data\r\n    ) {\r\n      featureLayerOBJ.LayerObject = featureLayer; // 添加图层到图层对象\r\n      featureLayerOBJ.LayerObject_yujing = featrueLayer_yujing; // 添加图层到图层对象\r\n      featureLayerOBJ.Rows = data.features; // 添加图层特征点数据到图层对象\r\n      // 更新FeatrueLayers\r\n      this.FeatrueLayers.forEach((val, index) => {\r\n        if (val.itype == featureLayerOBJ.itype) {\r\n          this.FeatrueLayers.splice(index, 1, featureLayerOBJ);\r\n        }\r\n      });\r\n      return featureLayerOBJ;\r\n    },\r\n    // 添加选中提示的图形图层到地图\r\n    add_GraphicsLayer_Selection_ToMap() {\r\n      var graphicsLayer_Selection = new esri.layers.GraphicsLayer();\r\n      this.map.addLayer(graphicsLayer_Selection);\r\n      this.graphicsLayer_Selection.LayerObject = graphicsLayer_Selection;\r\n    },\r\n    // 添加图形符号到选中提示的图形图层\r\n    add_Graphic_To_GraphicsLayer_Selection(item) {\r\n      var point = new esri.geometry.Point(\r\n        item.LGTD,\r\n        item.LTTD,\r\n        this.map.spatialReference\r\n      );\r\n      var pictureSymbol = new esri.symbol.PictureMarkerSymbol(\r\n        // getRootPath() + \"images/plot/point1.png\",\r\n        \"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2229475421,1482637450&fm=26&gp=0.jpg\",\r\n        20.4,\r\n        20.4\r\n      );\r\n      var graphic = new esri.Graphic(point, pictureSymbol);\r\n      this.graphicsLayer_Selection.LayerObject.add(graphic);\r\n      this.graphicsLayer_Selection.graphics.push(graphic);\r\n    },\r\n    // 清除图形图层里的所有图形符号\r\n    GraphicsLayer_Selection_clear() {\r\n      this.graphicsLayer_Selection.LayerObject.clear();\r\n    },\r\n    // 功能开发提示\r\n    developing_tip() {\r\n      this.$Message.warning(\"从功能正在开发中...\");\r\n    },\r\n    // 添加shp地图到map\r\n    addSHPlayerToMap() {\r\n      // 创建空底图（基础）部分\r\n      //var graphicsSHPlayer = new esri.layers.GraphicsLayer();\r\n      // 往地图对象添置 空底图\r\n      //this.map.addLayer(graphicsSHPlayer);\r\n\r\n      //图层加载\r\n      this.loadSHP();\r\n    },\r\n    enlarge_img(rows, index) {\r\n      // 图片放大模态框展示\r\n      this.imgModal_show();\r\n\r\n      var newRows = rows\r\n        ? JSON.parse(JSON.stringify(rows))\r\n        : this.enlargeModal_carousel.rows;\r\n      this.enlargeModal_carousel.Rows = newRows;\r\n      this.enlargeModal_carousel.initial_index = index || 0;\r\n    },\r\n    // 图片放大模态框展示\r\n    imgModal_show() {\r\n      this.$refs.imgModal.style.display = \"block\";\r\n      this.enlargeModal_carousel.show = true;\r\n    },\r\n    // 图片放大模态框隐藏\r\n    imgModal_hide() {\r\n      this.$refs.imgModal.style.display = \"none\";\r\n      this.enlargeModal_carousel.show = false;\r\n    },\r\n    // 图片顺时针旋转\r\n    clockwise_rotation() {\r\n      var ele = document.getElementById(\r\n        `img${this.enlargeModal_carousel.initial_index}`\r\n      );\r\n      var rotate = ele.style.transform;\r\n      // console.log(\"index\",this.enlargeModal_carousel.initial_index);\r\n      // console.log(\"ele\",ele);\r\n      if (rotate == \"\") {\r\n        ele.style.transform = `rotate(90deg)`;\r\n      } else {\r\n        rotate = parseInt(rotate.match(/\\d+/g));\r\n        ele.style.transform = `rotate(${rotate + 90}deg)`;\r\n      }\r\n      // .match(/\\d+/g)\r\n    },\r\n    // 图片逆时针旋转\r\n    counterclockwise_rotation() {\r\n      var ele = document.getElementById(\r\n        `img${this.enlargeModal_carousel.initial_index}`\r\n      );\r\n      var rotate = ele.style.transform;\r\n      if (rotate == \"\") {\r\n        ele.style.transform = `rotate(-90deg)`;\r\n      } else {\r\n        rotate = parseInt(rotate.match(/\\d+/g));\r\n        ele.style.transform = `rotate(${rotate - 90}deg)`;\r\n      }\r\n    },\r\n    // 图片还原\r\n    restore_rotation(imgID) {\r\n      var ele = document.getElementById(imgID);\r\n      if (ele) {\r\n        ele.style.transform = `rotate(0deg)`;\r\n      }\r\n    },\r\n    // 图片比率\r\n    scale(id, ratio) {\r\n      var ele = document.getElementById(id);\r\n      if (typeof ratio === \"string\") {\r\n        switch (ratio) {\r\n          case \"up\":\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    // 设置图片放大模态框轮播图自动播放\r\n    setCarousel_autoplay() {\r\n      this.enlargeModal_carousel.autoplay = true;\r\n    },\r\n    // 幻灯片切换触发事件\r\n    carousel_onChange(newIndex, oldIndex) {\r\n      // 旧图片旋转还原\r\n      this.restore_rotation(`img${oldIndex}`);\r\n      // 更新图片下标\r\n      this.enlargeModal_carousel.initial_index = newIndex;\r\n    },\r\n    // 消息窗口显示与否\r\n    Message_Window_show(boolean) {\r\n      if (boolean) {\r\n        this.Message_Window_Controller.show = false;\r\n      } else {\r\n        this.Message_Window_Controller.show = true;\r\n      }\r\n    },\r\n    // getFList(){\r\n    //     console.log('++++++++++++++++++', this.FeatrueLayers);\r\n    //     for(let i = 0;i < this.FeatrueLayers.length;i ++){\r\n    //         let obj = {\r\n    //             title: JSON.parse(JSON.stringify(this.FeatrueLayers))[i].title,\r\n    //             show: JSON.parse(JSON.stringify(this.FeatrueLayers)).show\r\n    //         }\r\n    //         console.log('************',obj)\r\n    //     }\r\n    //     console.log('----------------',this.fList)\r\n    // }\r\n    \r\n    // 顶部菜单方法\r\n    handleSelect(key, keyPath) {\r\n    console.log(keyPath);\r\n    this.mapBox_show=0\r\n    this.$router.push(keyPath[0]);\r\n      },\r\n      navchange1(){\r\n        this.imgflag='jichushuju';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange2(){\r\n        this.imgflag='xinxifuwu';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange3(){\r\n        this.imgflag='zhafakongzhi';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange4(){\r\n        this.imgflag='zhibanguanli';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange5(){\r\n        this.imgflag='xiangguanpingtai';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange6(){\r\n        this.imgflag='yujingguanli';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange7(){\r\n        this.imgflag='lvdingguanli';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange8(){\r\n        this.imgflag='peishuiguanli';\r\n        console.log(this.imgflag)\r\n      },\r\n      navchange9(){\r\n        this.imgflag='weihuguanli';\r\n        console.log(this.imgflag)\r\n      }\r\n\r\n  },\r\n  computed: {},\r\n};\r\n",null]}