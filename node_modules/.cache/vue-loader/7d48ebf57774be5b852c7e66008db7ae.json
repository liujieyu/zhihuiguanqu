{"remainingRequest":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\huangcaiplace\\zhihuiguanqu\\src\\table\\table-zfzt\\table-history.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\huangcaiplace\\zhihuiguanqu\\src\\table\\table-zfzt\\table-history.vue","mtime":1577669404093},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport FilterMethods from \"@/assets/commonJS/FilterMethods\";\r\nimport GetDataMethods from \"@/assets/commonJS/GetDataMethods\";\r\nimport App from \"@/App.vue\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      qudao: true,\r\n      xingzhengquhua: false,\r\n      show1:true,\r\n      change2:true,\r\n      Menu: { show_Controller: false },\r\n      span1:'19',\r\n      span2:'5',\r\n\r\n      //闸门动态图测试\r\n      testdata:[2,1,2,3,2,2],\r\n\r\n      Treedata: [],\r\n      Treedata: [],\r\n      GD:'',\r\n      data:[],\r\n      data1: [],\r\n      date:'',\r\n      searchs:\"\",\r\n      timesearch:'',\r\n      echarts:{\r\n        TM:[],\r\n        OD:[],\r\n        Q:[],\r\n        UPZ:[],\r\n        DWZ:[],\r\n      },\r\n      CZMC:'',\r\n      STinfo:{},\r\n      form:{\r\n        searchmsg:'',\r\n        date:'',\r\n        field:'',\r\n      },\r\n      searchmsg:'',\r\n      MaxY1:0,\r\n      MaxY2:0,\r\n      MinY1:0,\r\n      MinY2:0,\r\n      list_input: {\r\n        total: 100,\r\n        pagesize: 50,\r\n        pagesizeopts: [10, 20, 50, 75, 100, 200],\r\n        current: 1\r\n      }\r\n    };\r\n  },\r\n  // 引入过滤方法到此组件\r\n  mixins: [FilterMethods, GetDataMethods],\r\n  // watch: {\r\n  //   searchmsg(val) {\r\n  //     this.$refs.tree.filter(val);\r\n  //   }\r\n  // },\r\n  mounted() {\r\n    var date = new Date();\r\n    var Month = date.getMonth()+1;\r\n    var Day = date.getDate();\r\n    var datelist = new Array();\r\n    if (Month<10) {\r\n      Month = `0${Month}`\r\n    }\r\n    if (Day<10) {\r\n      Day = `0${Day}`\r\n    }\r\n    datelist[0] = date.getFullYear()+'-'+Month+'-'+Day+' 00:00:00';\r\n    datelist[1] = date.getFullYear()+'-'+Month+'-'+Day+' '+date.getHours()+':'+date.getMinutes()+':'+date.getSeconds();\r\n    this.form.date = datelist;\r\n    console.log(this.form.date);\r\n    this.axios.get(\"/guanqu/table/xingzhen_tree?type=6\").then(res => {\r\n          this.Treedata2 = this.XingZheng_Tree_Filter('650000000000',res.data).data;\r\n          //  this.Reload();\r\n    });\r\n    // 获取输排水渠道数据,然后设置渠道选择框选项\r\n    this.axios.get(\"/guanqu/table/qudao_tree?type=6\").then(res => {\r\n          this.Treedata = this.QuDao_Tree_Filter(res.data).data;\r\n          this.CZMC = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\r\n          this.STinfo.STNM = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\r\n          this.STinfo.STCD = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\r\n          console.log(this.QuDao_Tree_Filter(res.data));\r\n          this.searchs = `&STCD=${this.QuDao_Tree_Filter(res.data).siteinfo.canal_code}`;\r\n          this.Reload();\r\n          console.log('渠道',this.QuDao_Tree_Filter(res.data));\r\n    });\r\n      // this.Reload();\r\n  },\r\n  methods: {\r\n    change2on(){\r\n      this.change2 = !this.change2;\r\n    },\r\n    sort_change(column){\r\n              console.log(column);\r\n              if (column.order == 'ascending') {\r\n                this.form.field = column.prop;\r\n                this.Reload();\r\n              }\r\n              if (column.order == 'descending') {\r\n                this.form.field = column.prop+' desc';\r\n                this.Reload();\r\n              }\r\n              if (column.order == null) {\r\n                this.form.field = '';\r\n                this.Reload();\r\n              }\r\n    },\r\n    Menu_toggle() {\r\n      this.Menu.show_Controller = !this.Menu.show_Controller;\r\n      this.show1 = !this.show1;\r\n      if (this.show1 == true ) {\r\n        this.span1 = '19';\r\n        this.span2 = '5';\r\n        this.data2 = {};\r\n        this.Reload();\r\n      }else{\r\n        this.span1 = '24';\r\n        this.span2 = '0';\r\n        this.data2 = {};\r\n        this.Reload();\r\n      }\r\n    },\r\n\r\n    // 监听动态参数事件处理函数\r\n    test1(agmt) {\r\n      this.Menu.show_Controller = !agmt;\r\n      // this.show1 = agmt;\r\n      if (agmt) {\r\n        if(this.span1 == '24'){\r\n          this.span2 = '0';\r\n          this.asyncExecute();\r\n          return\r\n        }\r\n        this.span1 = '19';\r\n        this.span2 = '5';\r\n        this.data2 = {};\r\n        this.asyncExecute()\r\n      } else {\r\n        if(this.span1 == '24'){\r\n          this.span2 = '0';\r\n          this.asyncExecute();\r\n          return;\r\n        }\r\n        this.span1 = '19';\r\n        this.span2 = '5';\r\n        this.data2 = {};\r\n        this.asyncExecute()\r\n      }\r\n    },\r\n    // 异步刷新，重新绘图\r\n    asyncExecute(){\r\n      setTimeout(this.Reload, 100)\r\n    },\r\n    rekaishi(){\r\n      this.$refs.zhamenimg.style.height = '196px';\r\n    },\r\n    kaishi(){\r\n      this.$refs.zhamenimg.style.height = '150px';\r\n      console.log(this.$refs.zhamenimg.style.height)\r\n    },\r\n    qudao_tree(data) {\r\n                console.log(data);\r\n                if (data.bj !== 0) {\r\n                    this.searchs = '&STCD='+data.canal_code;\r\n                    this.STinfo.STCD = data.canal_code;\r\n                    this.STinfo.STNM = data.canal_name;\r\n                    // this.STinfo = data;\r\n                    this.CZMC = data.label.replace('【站点】','');\r\n                    this.Reload();\r\n                }\r\n            },\r\n            xingzheng_tree(data) {\r\n                console.log(data);\r\n                if (data.bj !== 0) {\r\n                    this.searchs = '&STCD='+data.ad_cd;\r\n                    this.STinfo.STCD = data.ad_cd;\r\n                    this.STinfo.STNM = data.ad_nm;\r\n                    // this.STinfo = data;\r\n                    this.CZMC = data.label.replace('【站点】','');\r\n                    this.Reload();\r\n                }\r\n            },\r\n    filterNode(value, Treedata ,node) {\r\n      this.filterTreeData.push(node);\r\n      if (!value) return true;\r\n      return Treedata.label.indexOf(value) !== -1;\r\n    },\r\n    search(){\r\n      // console.log(this.searchmsg);\r\n      this.filterTreeData = [];\r\n      this.$refs.tree.filter(this.searchmsg);\r\n\r\n      if (this.searchmsg != '') {\r\n        this.filterTreeData.some((val, index) => {\r\n        // console.log(val.expanded,val.data.bj)\r\n        if (val.visible && val.data.bj == 0 && val.data.canal_code) {\r\n          console.log(val);\r\n          val.isCurrent = true;\r\n          this.searchs = `&STCD=${val.data.canal_code}`;\r\n          this.CZMC = val.label;\r\n          console.log(\"this.searchmsg\",this.searchmsg)\r\n          return true;\r\n        }else if(val.visible && val.data.bj == 0 && val.data.ad_cd){\r\n          val.isCurrent = true;\r\n          this.searchs = `&STCD=${val.data.ad_cd}`;\r\n          this.CZMC = val.label;\r\n          return true;\r\n        }\r\n      })\r\n        this.Reload();\r\n      }else{\r\n        this.searchs = '';\r\n        this.Reload();\r\n      }\r\n    },\r\n    timechange(){\r\n      console.log(this.form.date);\r\n      this.Reload();\r\n    },\r\n    cellclick(){\r\n      console.log(\"+++++++++++\");\r\n       console.log(this.STinfo);\r\n      if (JSON.stringify(this.STinfo) == \"{}\") {\r\n        this.$Message.warning('请先选择站点');\r\n      }else{\r\n        var evt = new Object();\r\n        evt.graphic = new Object();\r\n        evt.graphic.attributes = this.STinfo;\r\n\r\n\r\n        // evt.graphic.attributes.STCD = this.STinfo.canal_code;\r\n        // evt.graphic.attributes.STNM = this.STinfo.canal_name;\r\n        // evt.graphic.attributes.STCD = this.STinfo.ad_cd;\r\n        // evt.graphic.attributes.STNM = this.STinfo.ad_nm;\r\n        evt.graphic.attributes.itype = \"zhafazhuangtai\";\r\n        evt.graphic.attributes.rowinfo = JSON.parse(JSON.stringify(this.STinfo))\r\n        evt.graphic.attributes.rowinfo.tableType = {\r\n          zfzt: \"historyTable\"\r\n        };\r\n        var v = new Object;\r\n        v.itype = \"zhafazhuangtai\";\r\n        console.log(\"evt\",evt);\r\n        this.$App.showDrawer(evt, v);\r\n      }\r\n    },\r\n    drawchart() {\r\n      var achart = this.$echarts.init(this.$refs.achart);\r\n      console.log(achart);\r\n      achart.resize();\r\n      achart.setOption({\r\n        title: { text: \"\" },\r\n        tooltip: {\r\n          trigger: \"axis\"\r\n        },\r\n        legend: {\r\n          data: [\"闸门开度\", \"过闸流量\", \"闸前水深\", \"闸后水深\"]\r\n        },\r\n        calculable: true,\r\n        xAxis: [\r\n          {\r\n            type: \"category\",\r\n            boundaryGap: false,\r\n            data:this.data.x.list, //控制x轴时间数据\r\n            axisLabel:{interval:parseInt(this.data.x.list.length/3.2),rotate:50},\r\n          }\r\n        ],\r\n        grid: { // 控制图的大小，调整下面这些值就可以，\r\n          x: 70,\r\n          x2: 40,\r\n          y2: 100// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上\r\n        },\r\n        yAxis: [\r\n          {\r\n            name: \"流量\",\r\n            type: \"value\",\r\n            min:this.data.y1.min,\r\n            max:this.data.y1.max\r\n          },\r\n          {\r\n            name: \"水深\",\r\n            type: \"value\",\r\n            min:this.data.y.min,\r\n            max:this.data.y.max\r\n          }\r\n        ],\r\n        series: [\r\n          {\r\n            name: \"闸门开度\",\r\n            type: \"line\",\r\n            yAxisIndex: 1,\r\n            data:this.data.y4.list\r\n            // data: [0.75, 0.69, 0.64, 0.75, 0.64]\r\n          },\r\n          {\r\n            name: \"过闸流量\",\r\n            type: \"line\",\r\n            yAxisIndex: 0,\r\n            data:this.data.y1.list\r\n            // data: [0.36, 0.28, 0.36, 0.02, 0.12]\r\n          },\r\n          {\r\n            name: \"闸前水深\",\r\n            type: \"line\",\r\n            yAxisIndex: 1,\r\n            data:this.data.y2.list\r\n            // data: [5.0, 10.0, 20.0, 25.0, 22.0]\r\n          },\r\n          {\r\n            name: \"闸后水深\",\r\n            type: \"line\",\r\n            yAxisIndex: 1,\r\n            data:this.data.y3.list\r\n            // data: [6.0, 9.0, 18.0, 22.0, 20.0]\r\n          }\r\n        ]\r\n      });\r\n    },\r\n    err(){\r\n      this.$Message.warning('该功能还在开发中...');\r\n    },\r\n    indexMethod(index){\r\n      return index + 1 + (this.list_input.pagesize*(this.list_input.current-1));\r\n    },\r\n    changeTree() {\r\n      this.qudao = !this.qudao;\r\n      this.xingzhengquhua = !this.xingzhengquhua;\r\n      this.Reload();\r\n    },\r\n    Reload() {\r\n      this.loading = true;\r\n      // this.axios.get(\"/guanqu/table/ST_Gatage_H?_page_size=\"+this.list_input.pagesize +\"&_page=\" +this.list_input.current+this.searchs,{params:{TM:'bt,'+this.form.date[0]+','+this.form.date[1],_orderby:this.form.field}}).then(res => {\r\n      //     console.log(res);\r\n      //     this.data1 = res.data.rows;\r\n      //     if (res.data.total != 0) {\r\n      //       this.CZMC = res.data.rows[0].STNM;\r\n      //       this.STinfo = res.data.rows[0];\r\n      //     }\r\n      //     this.list_input.total = res.data.total;\r\n      //     this.loading = false;\r\n      //     for (var i = 0; i < this.data1.length; i++) {\r\n      //       this.data1[i].OD = this.Z_Filter(this.data1[i].OD);\r\n      //       this.data1[i].Q = this.Z_Filter(this.data1[i].Q, 3);\r\n      //       this.data1[i].UPZ = this.Z_Filter(this.data1[i].UPZ);\r\n      //       this.data1[i].DWZ = this.Z_Filter(this.data1[i].DWZ);\r\n      //       this.data1[i].TM = this.dateFilter(this.data1[i].TM);\r\n      //       this.data1[i].STNM = this.data1[i].STNM.replace('**','');\r\n      //     }\r\n      //     if (res.data.total != 0) {\r\n      //       this.GD = this.data1[0].OD;\r\n      //       this.CZMC = this.data1[0].STNM;\r\n      //     }else{\r\n      //       this.GD = 0;\r\n      //     }\r\n\r\n      //     this.axios.get(\"/guanqu/table/ST_Gatage_H?_page=1&_page_size=99999\"+this.searchs,{params:{TM:'bt,'+this.form.date[0]+','+this.form.date[1]}}).then(res => {\r\n      //       this.data = res.data.rows;\r\n      //       for (var i = 0;i<this.data.length ; i++) {\r\n      //         this.data[i].TM = this.dateFilter(this.data[i].TM);\r\n      //       }\r\n      //       this.data = this.transform_ZFZT_data_into_ehart_data(this.data,'historyTable');\r\n      //     this.drawchart();\r\n      //     });\r\n      //   });\r\n\r\n\r\n\r\n        this.axios.get(\"/guanqu/zhafakongzhi/kaidulishi?_page_size=\"+this.list_input.pagesize +\"&_page=\" +this.list_input.current+this.searchs,{params:{Time_min:this.form.date[0],Time_max:this.form.date[1],_orderby:this.form.field}}).then(res => {\r\n          console.log('data1数据')\r\n          console.log(res);\r\n          this.data1 = res.data.list;\r\n          this.loading = false;\r\n          //  this.axios.get(\"/guanqu/zhafakongzhi/kaidulishi?_page=1&_page_size=99999\"+this.searchs,{params:{Time_min:this.form.date[0], Time_max:this.form.date[1]}}).then(res => {\r\n          //   console.log('data数据')\r\n          //   console.log(res)\r\n          //   this.data = res.data.list;\r\n          //   this.data = this.transform_ZFZT_data_into_ehart_data(this.data,'historyTable');\r\n          //   this.drawchart();\r\n\r\n\r\n          //   for (var i = 0;i<this.data.length ; i++) {\r\n          //     this.data[i].TM = this.dateFilter(this.data[i].TM);\r\n          //   }\r\n          // //   this.data = this.transform_ZFZT_data_into_ehart_data(this.data,'historyTable');\r\n          // // this.drawchart();\r\n          // });\r\n\r\n          // if (res.data.total != 0) {\r\n          //   this.CZMC = res.data.rows[0].STNM;\r\n          //   this.STinfo = res.data.rows[0];\r\n          // }\r\n          this.list_input.total = res.data.total;\r\n          this.loading = false;\r\n          for (var i = 0; i < this.data1.length; i++) {\r\n            this.data1[i].OD = this.Z_Filter(this.data1[i].OD);\r\n            this.data1[i].Q = this.Z_Filter(this.data1[i].Q, 3);\r\n            this.data1[i].UPZ = this.Z_Filter(this.data1[i].UPZ);\r\n            this.data1[i].DWZ = this.Z_Filter(this.data1[i].DWZ);\r\n            // this.data1[i].TM = this.dateFilter(this.data1[i].TM);\r\n            // this.data1[i].STNM = this.data1[i].STNM.replace('**','');\r\n          }\r\n          if (res.data.total != 0) {\r\n            this.GD = this.data1[0].OD;\r\n            // this.CZMC = this.data1[0].STNM;\r\n          }else{\r\n            this.GD = 0;\r\n          }\r\n          //  this.axios.get(\"/guanqu/zhafakongzhi/kaidulishi?_page=1&_page_size=99999\"+this.searchs,{params:{TM:'bt,'+this.form.date[0]+','+this.form.date[1]}}).then(res => {\r\n          //   console.log('data数据')\r\n          //   console.log(res)\r\n          //   this.data = res.data.list.reverse();\r\n\r\n\r\n          //   for (var i = 0;i<this.data.length ; i++) {\r\n          //     this.data[i].TM = this.dateFilter(this.data[i].TM);\r\n          //   }\r\n          //   this.data = this.transform_ZFZT_data_into_ehart_data(this.data,'historyTable');\r\n          // this.drawchart();\r\n          // });\r\n});\r\n\r\nthis.axios.get(\"/guanqu/zhafakongzhi/kaidulishi?_page=1&_page_size=99999\"+this.searchs,{params:{Time_min:this.form.date[0], Time_max:this.form.date[1]}}).then(res => {\r\n\r\n            this.data = res.data.list;\r\n            // this.data = this.transform_ZFZT_data_into_ehart_data(this.data,'historyTable');\r\n            // this.drawchart();\r\n\r\n\r\n            for (var i = 0;i<this.data.length ; i++) {\r\n              this.data[i].TM = this.dateFilter(this.data[i].TM);\r\n\r\n            }\r\n          //   this.data = this.transform_ZFZT_data_into_ehart_data(this.data,'historyTable');\r\n          // this.drawchart();\r\n          this.data = this.transform_ZFZT_data_into_ehart_data(this.data,'historyTable');\r\n          console.log(\"***************************\");\r\n          console.log(this.data);\r\n            this.drawchart();\r\n          });\r\n\r\n    },\r\n    // 处理页码切换\r\n    CurrentChange(index) {\r\n      // console.log(index);\r\n      this.list_input.current = index;\r\n      this.Reload();\r\n    },\r\n    // 处理每页显示条数切换\r\n    PagesizeChange(pagesize) {\r\n      // console.log(pagesize)\r\n      this.list_input.pagesize = pagesize;\r\n      this.Reload();\r\n    }\r\n  },\r\n  created() {\r\n  },\r\n  computed: {\r\n    balabala() {\r\n      //console.log(this.$store.state.anniu);\r\n      return this.$store.state.anniu\r\n    }\r\n  },\r\n  watch: {\r\n    // 'this.$store.state.anniu': function(){\r\n    //   console.log(this.$store.state.anniu);\r\n    // }\r\n    balabala(curVal, oldVal) {\r\n      console.log(curVal);\r\n      this.test1(curVal)\r\n    }\r\n  },\r\n};\r\n",null]}