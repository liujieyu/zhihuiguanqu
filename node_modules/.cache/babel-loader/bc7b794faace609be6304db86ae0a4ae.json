{"remainingRequest":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js!D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work2022\\visualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-warmmessage\\warmmessage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-warmmessage\\warmmessage.vue","mtime":1675413359814},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\babel.config.js","mtime":1577669403468},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport WarmDataConfig from \"@/assets/commonJS/WarmDataConfig\";\nexport default {\n  props: {\n    maninfo: {}\n  },\n  data: function data() {\n    return {\n      social: [],\n      planlist: [],\n      typelist: [],\n      yjdjlist: [],\n      mancount: 0,\n      form: {\n        plan: '',\n        planname: '',\n        phone: '',\n        name: '',\n        content: '',\n        yjdj: '',\n        yjdjname: '',\n        allinfo: []\n      }\n    };\n  },\n  // 引入过滤方法到此组件\n  mixins: [WarmDataConfig],\n  mounted: function mounted() {\n    this.Reload();\n  },\n  methods: {\n    Reload: function Reload() {\n      var _this = this;\n\n      //发送平台\n      this.Get_SysForminfo('DXFS20190921', 1, function (data) {\n        _this.planlist = data;\n        _this.form.plan = data[0].value;\n      }); //预警等级\n\n      this.Get_SysForminfo('YJDXFB20190926', 1, function (data) {\n        _this.yjdjlist = data;\n      }); // this.Get_WrpFieldinfo('ST_AlarmInfo','Alarm',data => {\n      //     this.yjdjlist = data;\n      //});\n      //发送对象\n\n      this.Get_WrpFieldinfo('WRP_MAN', 'TYPES', function (data) {\n        var typelist = data;\n        _this.tabledata = new Array();\n        _this.form.allinfo = new Array();\n\n        for (var i = 0; i < typelist.length; i++) {\n          var info = new Object();\n          info.type = typelist[i].value;\n          info.title = typelist[i].label;\n          info.manname = \"\";\n          info.count = 0;\n          info.itype = \"fasongrenyuan\";\n          info.list = new Array();\n\n          _this.form.allinfo.push(info);\n        }\n      });\n    },\n    //选择人员\n    checkone: function checkone(val, event) {\n      if (event) {\n        for (var i = 0; i < this.form.allinfo.length; i++) {\n          if (val == this.form.allinfo[i].type) {\n            this.$emit('showdailog', this.form.allinfo[i]);\n          }\n        }\n      } else {\n        for (var i = 0; i < this.form.allinfo.length; i++) {\n          if (val == this.form.allinfo[i].type) {\n            this.form.allinfo[i].manname = \"\";\n            this.form.allinfo[i].count = 0;\n            this.form.allinfo[i].list = new Array();\n            break;\n          }\n        }\n      }\n    },\n    //设置手机号码\n    showphone: function showphone(dataobj) {\n      for (var i = 0; i < this.form.allinfo.length; i++) {\n        if (dataobj.type == this.form.allinfo[i].type) {\n          this.form.allinfo[i].list = dataobj.list;\n          this.form.allinfo[i].count = dataobj.list.length;\n          var names = \"\";\n\n          for (var t = 0; t < this.form.allinfo[i].list.length; t++) {\n            names += this.form.allinfo[i].list[t].NM + \"，\";\n          }\n\n          this.form.allinfo[i].manname = names.substr(0, names.length - 1);\n          break;\n        }\n      }\n    },\n    //取消复选框选中\n    cancelcheck: function cancelcheck(val) {\n      document.getElementsByName(val)[0].click();\n    },\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      var appid = \"预警短信 \" + this.form.yjdjname;\n      var sender = this.form.planname;\n      var tablename = this.form.plan;\n      var content = this.form.content;\n      var count = 0;\n\n      for (var i = 0; i < this.form.allinfo.length; i++) {\n        if (this.form.allinfo[i].list.length > 0) {\n          for (var t = 0; t < this.form.allinfo[i].list.length; t++) {\n            var receiver = this.form.allinfo[i].list[t].MOBILE;\n            var addtion1 = this.form.allinfo[i].list[t].NM;\n            var addtion2 = this.form.allinfo[i].list[t].UNIT;\n            var addtion3 = this.form.allinfo[i].list[t].ZW;\n            var postData = new Object();\n            postData[\"appid\"] = appid;\n            postData[\"sender\"] = sender;\n            postData[\"tablename\"] = tablename;\n            postData[\"receiver\"] = receiver;\n            postData[\"addtion1\"] = addtion1;\n            postData[\"addtion2\"] = addtion2;\n            postData[\"addtion3\"] = addtion3;\n            postData[\"content\"] = content;\n            this.axios.post('/alarm/addmessage', postData).then(function (res) {\n              if (res.data == \"ok\") {\n                count += 1;\n              }\n            });\n          }\n        }\n      }\n\n      var successtime = setInterval(function () {\n        if (_this2.mancount == count) {\n          _this2.$message({\n            message: '预警短信发送成功！',\n            type: 'success'\n          });\n\n          clearInterval(successtime);\n\n          _this2.clearOne();\n\n          _this2.clearTwo();\n\n          _this2.$refs['first'].style.display = \"\";\n          _this2.$refs['third'].style.display = \"none\";\n        }\n      }, 500);\n    },\n    clearOne: function clearOne() {\n      this.form.plan = this.planlist[0].value;\n      this.form.yjdj = \"\";\n      this.form.content = \"\";\n    },\n    clearTwo: function clearTwo() {\n      for (var i = 0; i < this.form.allinfo.length; i++) {\n        var box = document.getElementsByName(this.form.allinfo[i].type);\n\n        if (box[0].checked == true) {\n          box[0].click();\n        }\n      }\n    },\n    nextstep: function nextstep(step) {\n      //第一步验证\n      if (step == 2) {\n        if (typeof this.form.yjdj == \"undefined\" || this.form.yjdj == \"\") {\n          this.$message({\n            message: '请选择预警等级！',\n            type: 'warning'\n          });\n          return;\n        }\n\n        var str = this.form.content;\n\n        if (str.replace(\" \", \"\") == \"\") {\n          this.$message({\n            message: '请输入短信内容！',\n            type: 'warning'\n          });\n          return;\n        }\n\n        if (this.strlen(str) >= 140) {\n          this.$message({\n            message: '短信内容不能超过70个汉字！',\n            type: 'warning'\n          });\n          return;\n        } //发送平台名称\n\n\n        for (var t = 0; t < this.planlist.length; t++) {\n          if (this.form.plan == this.planlist[t].value) {\n            this.form.planname = this.planlist[t].label;\n            break;\n          }\n        } //预警等级名称\n\n\n        for (var t = 0; t < this.yjdjlist.length; t++) {\n          if (this.form.yjdj == this.yjdjlist[t].value) {\n            this.form.yjdjname = this.yjdjlist[t].label;\n            break;\n          }\n        }\n\n        this.$refs['first'].style.display = \"none\";\n        this.$refs['second'].style.display = \"\";\n      } //第二步验证\n      else {\n          this.mancount = 0;\n\n          for (var i = 0; i < this.form.allinfo.length; i++) {\n            this.mancount += this.form.allinfo[i].list.length;\n          }\n\n          if (this.mancount == 0) {\n            this.$message({\n              message: '请选择发送对象！',\n              type: 'warning'\n            });\n            return;\n          }\n\n          this.$refs['second'].style.display = \"none\";\n          this.$refs['third'].style.display = \"\";\n        }\n    },\n    prestep: function prestep(step) {\n      if (step == 1) {\n        this.$refs['first'].style.display = \"\";\n        this.$refs['second'].style.display = \"none\";\n      } else if (step == 2) {\n        this.$refs['second'].style.display = \"\";\n        this.$refs['third'].style.display = \"none\";\n      }\n    }\n  }\n};",{"version":3,"sources":["warmmessage.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<Content>\r\n            <div ref=\"first\">\r\n            <Card class=\"cardcss\">\r\n                <p slot=\"title\">预警短信信息输入</p>\r\n            <el-form ref=\"form\" :model=\"form\" label-width=\"100px\" size=\"small\">\r\n                <el-form-item label=\"发送平台：\">\r\n                    <RadioGroup v-model=\"form.plan\">\r\n                        <Radio v-for=\"item in planlist\" :label=\"item.value\" size=\"large\" name=\"plans\">{{item.label}}</Radio>\r\n                    </RadioGroup>\r\n                </el-form-item>\r\n                <el-form-item label=\"预警等级：\">\r\n                    <Select v-model=\"form.yjdj\"  style=\"width:200px;\" clearable>\r\n                        <Option v-for=\"item in yjdjlist\" :value=\"item.value\" :key=\"item.value\">{{ item.label }}</Option>\r\n                    </Select>\r\n                </el-form-item>\r\n                <el-form-item label=\"短信内容：\">\r\n                    <Input type=\"textarea\" v-model=\"form.content\" :rows=\"4\" :value=\"form.content\" clearable style=\"width:98%\" />\r\n                    <div style=\"color:red;font-size:11px;\">(短信内容不超过70个汉字)</div>\r\n                </el-form-item>\r\n            </el-form>\r\n            <Footer class=\"footer\">\r\n            <Button  type=\"primary\" @click=\"nextstep(2)\" icon=\"md-arrow-round-down\" size=\"large\">下一步</Button>\r\n            <Button  @click=\"clearOne\" style=\"margin-left:20px;\" icon=\"md-trash\" size=\"large\">清空</Button>\r\n            </Footer>\r\n            </Card>\r\n            </div>\r\n            <div ref=\"second\" style=\"display:none;\">\r\n                <Card class=\"cardcss\">\r\n                <p slot=\"title\">发送对象选择</p>\r\n                    <el-table\r\n                        :data=\"form.allinfo\"\r\n                        border\r\n                        style=\"width: 100%\"\r\n                        >\r\n                        <el-table-column label=\"人员类型\" align=\"left\" width=\"160\" >\r\n                          <template slot-scope=\"scope\">\r\n                          <Checkbox :label=\"scope.row.type\"  :name=\"scope.row.type\" size=\"large\" @on-change=\"checkone(scope.row.type,$event)\">{{scope.row.title}}</Checkbox>\r\n                           </template>\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                          prop=\"manname\"\r\n                          label=\"已选择人员\"\r\n                          align=\"center\"\r\n                          min-width=\"200\">\r\n                        </el-table-column>\r\n                      </el-table>\r\n                    <Footer class=\"footer\">\r\n                    <Button  type=\"primary\" @click=\"prestep(1)\" icon=\"md-arrow-round-up\" size=\"large\">上一步</Button>\r\n                    <Button  type=\"primary\" @click=\"nextstep(3)\" style=\"margin-left:20px;\" icon=\"md-arrow-round-down\" size=\"large\">下一步</Button>\r\n                    <Button  @click=\"clearTwo\" style=\"margin-left:20px;\" icon=\"md-trash\" size=\"large\">清空</Button>\r\n                    </Footer>\r\n               </Card>\r\n            </div>\r\n            <div ref=\"third\" style=\"display:none;\">\r\n              <Card class=\"cardcss\">\r\n                <p slot=\"title\">预警短信信息核对</p>\r\n                <table style=\"border: 1px solid #C7CCD6\" cellspacing=\"0\" width=\"100%\" class=\"warm_detail\">\r\n                <tr>\r\n                  <td align=\"right\" class=\"dt_name\">发送平台：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"padding-left:10px;\">{{ form.planname || \"&nbsp;\" }}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td align=\"right\" class=\"dt_name\" >预警等级：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"padding-left:10px;\">{{form.yjdjname|| \"&nbsp;\"}}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td align=\"right\" class=\"dt_name\">预警内容：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"padding-left:10px;border-bottom:0px;\">{{ form.content || \"&nbsp;\" }}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td align=\"right\" class=\"dt_name\" style=\"border-bottom:0px;\">发送对象：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"border-bottom:0px;\">\r\n                      <table cellspacing=\"0\" style=\"width:100%;\">\r\n                          <tr v-for=\"item in form.allinfo\" v-if=\"item.count>0\">\r\n                              <td style=\"width:150px;border-top: 1px solid #C7CCD6;border-right: 1px solid #C7CCD6;padding-left:10px;\">\r\n                                  <Badge :count=\"item.count\">\r\n                                    <Avatar shape=\"square\" icon=\"ios-person\" />\r\n                                </Badge>\r\n                                <div style=\"display:block-inline;float:right;\">\r\n                               {{item.title}}：\r\n                               </div>\r\n                              </td>\r\n                              <td style=\"border-top: 1px solid #C7CCD6;padding:10px 5px 5px 10px;\">\r\n                                  {{item.manname}}\r\n                              </td>\r\n                          </tr>\r\n                      </table>\r\n                  </td>\r\n                </tr>\r\n              </table>\r\n                <Footer class=\"footer\">\r\n                    <Button type=\"primary\" @click=\"prestep(2)\" icon=\"md-arrow-round-up\" size=\"large\">上一步</Button>\r\n                    <Button type=\"primary\" @click=\"onSubmit\" style=\"margin-left:20px;\" icon=\"md-cloud-upload\" size=\"large\">发送</Button>\r\n                </Footer>\r\n              </Card>\r\n            </div>\r\n        </Content>\r\n    </div>\r\n</template>\r\n<script type=\"text/javascript\">\r\n        import WarmDataConfig from \"@/assets/commonJS/WarmDataConfig\";\r\n\texport default {\r\n        props: {\r\n            maninfo: {}\r\n        },\r\n        data(){\r\n            return{\r\n                social:[],\r\n                planlist:[],\r\n                typelist:[],\r\n                yjdjlist:[],\r\n                mancount:0,\r\n                form:{\r\n                    plan:'',\r\n                    planname:'',\r\n                    phone:'',\r\n                    name:'',\r\n                    content:'',\r\n                    yjdj:'',\r\n                    yjdjname:'',\r\n                    allinfo:[]\r\n                },\r\n            }\r\n        },\r\n        // 引入过滤方法到此组件\r\n        mixins: [WarmDataConfig],\r\n        mounted(){\r\n            this.Reload();\r\n        },\r\n        methods:{\r\n            Reload(){\r\n                //发送平台\r\n                this.Get_SysForminfo('DXFS20190921',1,data => {\r\n                    this.planlist = data;\r\n                    this.form.plan=data[0].value;\r\n                });\r\n                //预警等级\r\n                this.Get_SysForminfo('YJDXFB20190926',1,data => {\r\n                    this.yjdjlist = data;\r\n                });\r\n               // this.Get_WrpFieldinfo('ST_AlarmInfo','Alarm',data => {\r\n               //     this.yjdjlist = data;\r\n                //});\r\n                //发送对象\r\n                this.Get_WrpFieldinfo('WRP_MAN','TYPES',data => {\r\n                    var typelist = data;\r\n                    this.tabledata=new Array();\r\n                    this.form.allinfo=new Array();\r\n                    for(var i=0;i<typelist.length;i++){\r\n                        var info=new Object();\r\n                        info.type=typelist[i].value;\r\n                        info.title=typelist[i].label;\r\n                        info.manname=\"\";\r\n                        info.count=0;\r\n                        info.itype=\"fasongrenyuan\";\r\n                        info.list=new Array();\r\n                        this.form.allinfo.push(info);\r\n                    }\r\n                });\r\n            },\r\n            //选择人员\r\n            checkone(val,event){\r\n                if(event){\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n                            this.$emit('showdailog', this.form.allinfo[i]);\r\n                        }\r\n                    }\r\n                }else{\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n                            this.form.allinfo[i].manname=\"\";\r\n                            this.form.allinfo[i].count=0;\r\n                            this.form.allinfo[i].list=new Array();\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n           //设置手机号码\r\n           showphone(dataobj){              \r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(dataobj.type==this.form.allinfo[i].type){\r\n                            this.form.allinfo[i].list=dataobj.list;\r\n                            this.form.allinfo[i].count=dataobj.list.length;\r\n                            var names=\"\";\r\n                            for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                                names+=this.form.allinfo[i].list[t].NM+\"，\";\r\n                            }\r\n                            this.form.allinfo[i].manname=names.substr(0,names.length-1);\r\n                            break;\r\n                        }\r\n                    }\r\n                \r\n                \r\n           },\r\n           //取消复选框选中\r\n           cancelcheck(val){\r\n               document.getElementsByName(val)[0].click();\r\n           },\r\n           onSubmit(){\r\n            var appid=\"预警短信 \"+this.form.yjdjname;\r\n            var sender=this.form.planname;\r\n            var tablename=this.form.plan;\r\n            var content=this.form.content;\r\n\r\n            var count=0;\r\n            for(var i=0;i<this.form.allinfo.length;i++){\r\n                    if(this.form.allinfo[i].list.length>0){\r\n                        for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                            var receiver=this.form.allinfo[i].list[t].MOBILE;\r\n                            var addtion1=this.form.allinfo[i].list[t].NM;\r\n                            var addtion2=this.form.allinfo[i].list[t].UNIT;\r\n                            var addtion3=this.form.allinfo[i].list[t].ZW;                        \r\n                            let postData=new Object();\r\n                            postData[\"appid\"]=appid;\r\n                            postData[\"sender\"]=sender;\r\n                            postData[\"tablename\"]=tablename;\r\n                            postData[\"receiver\"]=receiver;\r\n                            postData[\"addtion1\"]=addtion1;\r\n                            postData[\"addtion2\"]=addtion2;\r\n                            postData[\"addtion3\"]=addtion3;\r\n                            postData[\"content\"]=content;\r\n                            this.axios.post('/alarm/addmessage',postData).then((res)=>{\r\n                                if(res.data==\"ok\"){\r\n                                    count+=1;\r\n                                }                   \r\n                            }); \r\n                        }\r\n                    }\r\n                }\r\n              var successtime=  setInterval(() => {\r\n                    if(this.mancount==count){\r\n                        this.$message({message:'预警短信发送成功！',type:'success'});\r\n                        clearInterval(successtime);\r\n                        this.clearOne();\r\n                        this.clearTwo();\r\n                        this.$refs['first'].style.display=\"\";\r\n                        this.$refs['third'].style.display=\"none\";\r\n                    }\r\n                }, 500);\r\n           }, \r\n           clearOne(){\r\n               this.form.plan=this.planlist[0].value;\r\n               this.form.yjdj=\"\";\r\n               this.form.content=\"\";\r\n           },\r\n           clearTwo(){\r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                   var box=document.getElementsByName(this.form.allinfo[i].type);\r\n                   if (box[0].checked==true) {\r\n                      box[0].click();\r\n                   }\r\n               }\r\n           },\r\n           nextstep(step){\r\n               //第一步验证\r\n               if(step==2){\r\n                   if(typeof(this.form.yjdj)==\"undefined\" || this.form.yjdj==\"\"){\r\n                       this.$message({message:'请选择预警等级！',type:'warning'});\r\n                       return;\r\n                   }\r\n                   var str=this.form.content;\r\n                    if(str.replace(\" \",\"\")==\"\"){\r\n                        this.$message({message:'请输入短信内容！',type:'warning'});\r\n                        return;\r\n                    }\r\n                    if(this.strlen(str)>=140){\r\n                        this.$message({message:'短信内容不能超过70个汉字！',type:'warning'});\r\n                        return;\r\n                    }\r\n                    //发送平台名称\r\n                    for(var t=0;t<this.planlist.length;t++){\r\n                        if(this.form.plan==this.planlist[t].value){\r\n                            this.form.planname=this.planlist[t].label;\r\n                            break;\r\n                        }\r\n                    }\r\n                    //预警等级名称\r\n                    for(var t=0;t<this.yjdjlist.length;t++){\r\n                        if(this.form.yjdj==this.yjdjlist[t].value){\r\n                            this.form.yjdjname=this.yjdjlist[t].label;\r\n                            break;\r\n                        }\r\n                    }\r\n                    this.$refs['first'].style.display=\"none\";\r\n                    this.$refs['second'].style.display=\"\";\r\n               }//第二步验证\r\n               else{\r\n                   this.mancount=0;\r\n                   for(var i=0;i<this.form.allinfo.length;i++){\r\n                      this.mancount+=this.form.allinfo[i].list.length;\r\n                   }\r\n                   if(this.mancount==0){\r\n                       this.$message({message:'请选择发送对象！',type:'warning'});\r\n                        return;\r\n                   }\r\n                   this.$refs['second'].style.display=\"none\";\r\n                   this.$refs['third'].style.display=\"\";\r\n               }\r\n           },\r\n           prestep(step){\r\n               if(step==1){\r\n                  this.$refs['first'].style.display=\"\";\r\n                  this.$refs['second'].style.display=\"none\"; \r\n               }else if(step==2){\r\n                  this.$refs['second'].style.display=\"\";\r\n                  this.$refs['third'].style.display=\"none\";\r\n               }\r\n           }\r\n        }\r\n    }\r\n</script>\r\n<style lang=\"less\" scope>\r\n@import \"../../../components/Details/common/common.less\";\r\n.cardcss{\r\n    width:90%;\r\n    margin-left:16px;\r\n}\r\n.footer{\r\nbackground:#fff;\r\ntext-align:center;\r\n}\r\n.warm_detail {\r\n  td {\r\n    height: 45px;\r\n    border-top: none;\r\n    border-color: #C7CCD6;\r\n  }\r\n\r\n  .dt_name {\r\n    width: 18px;\r\n    border-right: #C7CCD6 1px solid;\r\n    border-bottom: #C7CCD6 1px solid;\r\n  }\r\n\r\n  .dt_vale {\r\n    width: 82%;\r\n    border-bottom: #C7CCD6 1px solid;\r\n  }\r\n}\r\n.nav {\r\n    height: 50px;\r\n    border-top: #C7CCD6 1px solid;\r\n}\r\n \r\n.nav ul {\r\n    list-style: none;\r\n}\r\n \r\n.nav li {\r\n    display: inline;\r\n    line-height: 40px;\r\n    float:left;\r\n    padding-left: 10px;\r\n    padding-top: 10px;\r\n}\r\n\r\n</style>"],"sourceRoot":"src/warm/warm-manage/warm-warmmessage"}]}