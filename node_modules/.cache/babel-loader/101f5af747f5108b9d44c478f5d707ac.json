{"remainingRequest":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js!D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work2022\\visualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-sendmessage\\warmsend.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-sendmessage\\warmsend.vue","mtime":1645514326432},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\babel.config.js","mtime":1577669403468},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport WarmDataConfig from \"@/assets/commonJS/WarmDataConfig\";\nexport default {\n  props: {\n    maninfo: {}\n  },\n  data: function data() {\n    return {\n      social: [],\n      planlist: [],\n      typelist: [],\n      form: {\n        plan: '',\n        phone: '',\n        name: '',\n        content: '',\n        allinfo: []\n      }\n    };\n  },\n  // 引入过滤方法到此组件\n  mixins: [WarmDataConfig],\n  mounted: function mounted() {\n    this.Reload();\n  },\n  methods: {\n    Reload: function Reload() {\n      var _this = this;\n\n      this.Get_SysForminfo('DXFS20190921', 1, function (data) {\n        _this.planlist = data;\n        _this.form.plan = data[0].value;\n      });\n      this.Get_WrpFieldinfo('WRP_MAN', 'TYPES', function (data) {\n        _this.typelist = data;\n        _this.form.allinfo = new Array();\n\n        for (var i = 0; i < _this.typelist.length; i++) {\n          var info = new Object();\n          info.type = _this.typelist[i].value;\n          info.title = _this.typelist[i].label;\n          info.itype = \"fasongrenyuan\";\n          info.list = new Array();\n\n          _this.form.allinfo.push(info);\n        }\n      });\n    },\n    //选择人员\n    checkone: function checkone(val, event) {\n      if (event) {\n        for (var i = 0; i < this.form.allinfo.length; i++) {\n          if (val == this.form.allinfo[i].type) {\n            this.$emit('showdailog', this.form.allinfo[i]);\n          }\n        }\n      } else {\n        var typephone = \"\";\n        this.form.phone += \",\";\n\n        for (var i = 0; i < this.form.allinfo.length; i++) {\n          if (val == this.form.allinfo[i].type) {\n            for (var t = 0; t < this.form.allinfo[i].list.length; t++) {\n              typephone += this.form.allinfo[i].list[t].MOBILE + \",\";\n              this.form.phone = this.form.phone.replace(this.form.allinfo[i].list[t].MOBILE + \",\", \"\");\n            }\n\n            this.form.allinfo[i].list = new Array();\n            break;\n          }\n        }\n\n        this.form.phone = this.form.phone.substr(0, this.form.phone.length - 1);\n      }\n    },\n    //设置手机号码\n    showphone: function showphone(dataobj) {\n      var phonestr = \"\";\n\n      for (var i = 0; i < this.form.allinfo.length; i++) {\n        if (dataobj.type == this.form.allinfo[i].type) {\n          this.form.allinfo[i].list = dataobj.list;\n\n          for (var t = 0; t < this.form.allinfo[i].list.length; t++) {\n            phonestr += this.form.allinfo[i].list[t].MOBILE + \",\";\n          }\n\n          break;\n        }\n      }\n\n      if (phonestr != \"\") {\n        if (this.form.phone == \"\") {\n          this.form.phone += phonestr.substr(0, phonestr.length - 1);\n        } else {\n          this.form.phone += \",\" + phonestr.substr(0, phonestr.length - 1);\n        }\n      }\n    },\n    //取消复选框选中\n    cancelcheck: function cancelcheck(val) {\n      document.getElementsByName(val)[0].click();\n    },\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      if (this.form.phone == \"\") {\n        this.$message({\n          message: '请选择要发送短信的人员或输入手机号码！',\n          type: 'warning'\n        });\n        return;\n      }\n\n      var myreg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/;\n      var phones = this.form.phone.split(\",\");\n\n      for (var h = 0; h < phones.length; h++) {\n        if (!myreg.test(phones[h])) {\n          this.$message({\n            message: '手机号码 “' + phones[h] + '” 异常！',\n            type: 'warning'\n          });\n          return;\n        }\n      }\n\n      var str = this.form.content;\n\n      if (str.replace(\" \", \"\") == \"\") {\n        this.$message({\n          message: '请输入短信内容！',\n          type: 'warning'\n        });\n        return;\n      }\n\n      if (this.strlen(str) >= 140) {\n        this.$message({\n          message: '短信内容不能超过70个汉字！',\n          type: 'warning'\n        });\n        return;\n      }\n\n      var appid = \"普通短信\";\n      var sender = \"\";\n      var tablename = this.form.plan;\n\n      for (var t = 0; t < this.planlist.length; t++) {\n        if (this.form.plan == this.planlist[t].value) {\n          sender = this.planlist[t].label;\n          break;\n        }\n      }\n\n      var content = this.form.content;\n      var sendlen = phones.length;\n      var count = 0;\n\n      for (var s = 0; s < sendlen; s++) {\n        var sign = 0;\n\n        for (var i = 0; i < this.form.allinfo.length; i++) {\n          if (this.form.allinfo[i].list.length > 0) {\n            for (var t = 0; t < this.form.allinfo[i].list.length; t++) {\n              var receiver = this.form.allinfo[i].list[t].MOBILE;\n              var addtion1 = this.form.allinfo[i].list[t].NM;\n              var addtion2 = this.form.allinfo[i].list[t].UNIT;\n              var addtion3 = this.form.allinfo[i].list[t].ZW;\n\n              if (phones[s] == receiver) {\n                sign = 1;\n                var postData = new Object();\n                postData[\"appid\"] = appid;\n                postData[\"sender\"] = sender;\n                postData[\"tablename\"] = tablename;\n                postData[\"receiver\"] = receiver;\n                postData[\"addtion1\"] = addtion1;\n                postData[\"addtion2\"] = addtion2;\n                postData[\"addtion3\"] = addtion3;\n                postData[\"content\"] = content;\n                this.axios.post('/alarm/addmessage', postData).then(function (res) {\n                  if (res.data == \"ok\") {\n                    count += 1;\n                  }\n                });\n              }\n            }\n          }\n        }\n\n        if (sign == 0) {\n          var _postData = new Object();\n\n          _postData[\"appid\"] = appid;\n          _postData[\"sender\"] = sender;\n          _postData[\"tablename\"] = tablename;\n          _postData[\"receiver\"] = phones[s];\n          _postData[\"addtion1\"] = \"\";\n          _postData[\"addtion2\"] = \"\";\n          _postData[\"addtion3\"] = \"\";\n          _postData[\"content\"] = content;\n          this.axios.post('/alarm/addmessage', _postData).then(function (res) {\n            if (res.data == \"ok\") {\n              count += 1;\n            }\n          });\n        }\n      }\n\n      var successtime = setInterval(function () {\n        if (sendlen == count) {\n          _this2.$message({\n            message: '短信发送成功！',\n            type: 'success'\n          });\n\n          clearInterval(successtime);\n\n          _this2.onClear();\n        }\n      }, 500);\n    },\n    onClear: function onClear() {\n      this.form.plan = this.planlist[0].value;\n\n      for (var i = 0; i < this.form.allinfo.length; i++) {\n        var box = document.getElementsByName(this.form.allinfo[i].type);\n\n        if (box[0].checked == true) {\n          box[0].click();\n        }\n      }\n\n      this.form.phone = \"\";\n      this.form.content = \"\";\n    }\n  }\n};",{"version":3,"sources":["warmsend.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<Content>\r\n            <Card class=\"cardcss\">\r\n            <p slot=\"title\">短信信息输入</p>\r\n            <el-form ref=\"form\" :model=\"form\" label-width=\"100px\" size=\"small\">\r\n                <el-form-item label=\"发送平台：\">\r\n                    <RadioGroup v-model=\"form.plan\">\r\n                        <Radio v-for=\"item in planlist\" :label=\"item.value\" size=\"large\" name=\"plans\">{{item.label}}</Radio>\r\n                    </RadioGroup>\r\n                </el-form-item>\r\n                <el-form-item label=\"人员类型：\">\r\n                    <Checkbox v-for=\"item in typelist\" :label=\"item.value\"  :name=\"item.value\" size=\"large\" @on-change=\"checkone(item.value,$event)\">{{item.label}}</Checkbox>\r\n                </el-form-item>\r\n                <el-form-item label=\"手机号码：\">\r\n                    <Input v-model=\"form.phone\" :value=\"form.phone\" clearable style=\"width:98%\"/>\r\n                    <div style=\"color:red;font-size:11px;\">(手机号码之间请用英文标点“,”隔开)</div>\r\n                </el-form-item>\r\n                <el-form-item label=\"短信内容：\">\r\n                    <Input type=\"textarea\" v-model=\"form.content\" :rows=\"4\" :value=\"form.content\" clearable style=\"width:98%\" />\r\n                    <div style=\"color:red;font-size:11px;\">(短信内容不超过70个汉字)</div>\r\n                </el-form-item>\r\n            </el-form>\r\n            <Footer class=\"footer\">\r\n            <Button  type=\"primary\" @click=\"onSubmit\" icon=\"md-cloud-upload\" size=\"large\">发送</Button>\r\n            <Button  @click=\"onClear\" style=\"margin-left:20px;\" icon=\"md-trash\" size=\"large\">清空</Button>\r\n            </Footer>\r\n            </Card>\r\n        </Content>\r\n    </div>\r\n</template>\r\n<script type=\"text/javascript\">\r\n        import WarmDataConfig from \"@/assets/commonJS/WarmDataConfig\";\r\n\texport default {\r\n        props: {\r\n            maninfo: {}\r\n        },\r\n        data(){\r\n            return{\r\n                social:[],\r\n                planlist:[],\r\n                typelist:[],\r\n                form:{\r\n                    plan:'',\r\n                    phone:'',\r\n                    name:'',\r\n                    content:'',\r\n                    allinfo:[]\r\n                },\r\n            }\r\n        },\r\n        // 引入过滤方法到此组件\r\n        mixins: [WarmDataConfig],\r\n        mounted(){\r\n            this.Reload();\r\n        },\r\n        methods:{\r\n            Reload(){\r\n                this.Get_SysForminfo('DXFS20190921',1,data => {\r\n                    this.planlist = data;\r\n                    this.form.plan=data[0].value;\r\n                });\r\n                this.Get_WrpFieldinfo('WRP_MAN','TYPES',data => {\r\n                    this.typelist = data;\r\n                    this.form.allinfo=new Array();\r\n                    for(var i=0;i<this.typelist.length;i++){\r\n                        var info=new Object();\r\n                        info.type=this.typelist[i].value;\r\n                        info.title=this.typelist[i].label;\r\n                        info.itype=\"fasongrenyuan\";\r\n                        info.list=new Array();\r\n                        this.form.allinfo.push(info);\r\n                    }\r\n                });\r\n            },\r\n            //选择人员\r\n            checkone(val,event){\r\n                if(event){\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n                            this.$emit('showdailog', this.form.allinfo[i]);\r\n                        }\r\n                    }\r\n                }else{\r\n                    var typephone=\"\";\r\n                    this.form.phone+=\",\";\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n\r\n                            for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                                typephone+=this.form.allinfo[i].list[t].MOBILE+\",\"; \r\n                                 this.form.phone=this.form.phone.replace(this.form.allinfo[i].list[t].MOBILE+\",\",\"\");                         \r\n                            }\r\n                            this.form.allinfo[i].list=new Array();\r\n                            break;\r\n                        }\r\n                    }\r\n                    this.form.phone=this.form.phone.substr(0,this.form.phone.length-1);\r\n                }\r\n            },\r\n           //设置手机号码\r\n           showphone(dataobj){\r\n               var phonestr=\"\";\r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(dataobj.type==this.form.allinfo[i].type){\r\n                            this.form.allinfo[i].list=dataobj.list;\r\n                            for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                                phonestr+=this.form.allinfo[i].list[t].MOBILE+\",\";\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                if(phonestr!=\"\"){\r\n                    if(this.form.phone==\"\"){\r\n                        this.form.phone+=phonestr.substr(0,phonestr.length-1);\r\n                    }else{\r\n                        this.form.phone+=\",\"+phonestr.substr(0,phonestr.length-1); \r\n                    }\r\n                }\r\n                \r\n                \r\n           },\r\n           //取消复选框选中\r\n           cancelcheck(val){\r\n               document.getElementsByName(val)[0].click();\r\n           },\r\n           onSubmit(){\r\n            if(this.form.phone==\"\"){\r\n                this.$message({message:'请选择要发送短信的人员或输入手机号码！',type:'warning'});\r\n                return;\r\n            }\r\n            var myreg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/;\r\n            var phones=this.form.phone.split(\",\");\r\n            for(var h=0;h<phones.length;h++){\r\n                if(!(myreg.test(phones[h]))){ \r\n                    this.$message({message:'手机号码 “'+phones[h]+'” 异常！',type:'warning'});  \r\n                    return; \r\n                }\r\n            }\r\n            var str=this.form.content;\r\n            if(str.replace(\" \",\"\")==\"\"){\r\n                this.$message({message:'请输入短信内容！',type:'warning'});\r\n                return;\r\n            }\r\n            if(this.strlen(str)>=140){\r\n                this.$message({message:'短信内容不能超过70个汉字！',type:'warning'});\r\n                return;\r\n            }\r\n            var appid=\"普通短信\";\r\n            var sender=\"\";\r\n            var tablename=this.form.plan;\r\n            for(var t=0;t<this.planlist.length;t++){\r\n                if(this.form.plan==this.planlist[t].value){\r\n                    sender=this.planlist[t].label;\r\n                    break;\r\n                }\r\n            }\r\n            var content=this.form.content;\r\n\r\n            var sendlen=phones.length;\r\n            var count=0;\r\n            for(var s=0;s<sendlen;s++){\r\n                var sign=0;\r\n                for(var i=0;i<this.form.allinfo.length;i++){\r\n                    if(this.form.allinfo[i].list.length>0){\r\n                        for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                            var receiver=this.form.allinfo[i].list[t].MOBILE;\r\n                            var addtion1=this.form.allinfo[i].list[t].NM;\r\n                            var addtion2=this.form.allinfo[i].list[t].UNIT;\r\n                            var addtion3=this.form.allinfo[i].list[t].ZW; \r\n                         if(phones[s]==receiver){\r\n                            sign=1;                       \r\n                            let postData=new Object();\r\n                            postData[\"appid\"]=appid;\r\n                            postData[\"sender\"]=sender;\r\n                            postData[\"tablename\"]=tablename;\r\n                            postData[\"receiver\"]=receiver;\r\n                            postData[\"addtion1\"]=addtion1;\r\n                            postData[\"addtion2\"]=addtion2;\r\n                            postData[\"addtion3\"]=addtion3;\r\n                            postData[\"content\"]=content;\r\n                            this.axios.post('/alarm/addmessage',postData).then((res)=>{\r\n                                if(res.data==\"ok\"){\r\n                                    count+=1;\r\n                                }                   \r\n                            });\r\n                          } \r\n                        }\r\n                    }\r\n                }\r\n                if(sign==0){\r\n                    let postData=new Object();\r\n                            postData[\"appid\"]=appid;\r\n                            postData[\"sender\"]=sender;\r\n                            postData[\"tablename\"]=tablename;\r\n                            postData[\"receiver\"]=phones[s];\r\n                            postData[\"addtion1\"]=\"\";\r\n                            postData[\"addtion2\"]=\"\";\r\n                            postData[\"addtion3\"]=\"\";\r\n                            postData[\"content\"]=content;\r\n                            this.axios.post('/alarm/addmessage',postData).then((res)=>{\r\n                                if(res.data==\"ok\"){\r\n                                    count+=1;\r\n                                }                   \r\n                            });\r\n                }\r\n            }\r\n              var successtime=  setInterval(() => {\r\n                    if(sendlen==count){\r\n                        this.$message({message:'短信发送成功！',type:'success'});\r\n                        clearInterval(successtime);\r\n                        this.onClear();\r\n                    }\r\n                }, 500);\r\n           },\r\n           onClear(){\r\n               this.form.plan=this.planlist[0].value;\r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                   var box=document.getElementsByName(this.form.allinfo[i].type);\r\n                   if (box[0].checked==true) {\r\n                      box[0].click();\r\n                   }\r\n               }\r\n                this.form.phone=\"\";\r\n                this.form.content=\"\";\r\n           } \r\n        }\r\n    }\r\n</script>\r\n<style lang=\"less\" scope>\r\n.cardcss{\r\n    width:90%;\r\n    margin-left:16px;\r\n}\r\n.footer{\r\nbackground:#fff;\r\ntext-align:center;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/warm/warm-manage/warm-sendmessage"}]}