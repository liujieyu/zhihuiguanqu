{"remainingRequest":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\huangcaiplace\\zhihuiguanqu\\src\\table\\table-yxgk\\table-history.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\huangcaiplace\\zhihuiguanqu\\src\\table\\table-yxgk\\table-history.vue","mtime":1586835310407},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport FilterMethods from \"@/assets/commonJS/FilterMethods\";\nimport GetDataMethods from \"@/assets/commonJS/GetDataMethods\";\nimport App from \"@/App.vue\";\n\nexport default {\n    data() {\n        return {\n            loading: false,\n            qudao: true,\n            xingzhengquhua: false,\n            show1: true,\n            Menu: {show_Controller: false},\n            span1: '19',\n            span2: '5',\n            STinfo: {},\n            Treedata: [],\n            Treedata2: [],\n            GD: '',\n            data1: [],\n            data2: [],\n            date: '',\n            searchs: '&STNM= P2支渠站',\n            timesearch: '',\n            CZMC: '',\n            echarts: {\n                TM: [],\n                VOL: [],\n            },\n            form: {\n                searchmsg: '',\n                date: '',\n                field: '',\n            },\n            searchmsg: '',\n            MaxY: 0,\n            MinY: 0,\n            ZCDY: {},\n            list_input: {\n                total: 100,\n                pagesize: 50,\n                pagesizeopts: [10, 20, 50, 75, 100, 200],\n                current: 1\n            },\n            SiteiNFO: {\n                CZMC: '',\n                STCD: ''\n            }\n        };\n    },\n    // 引入过滤方法到此组件\n    mixins: [FilterMethods, GetDataMethods],\n    // watch: {\n    //   searchmsg(val) {\n    //     this.$refs.tree.filter(val);\n    //   }\n    // },\n    mounted() {\n        this.form.field = 'TM'\n        var date = new Date();\n        var Month = date.getMonth() + 1;\n        var datelist = new Array();\n        datelist[0] = date.getFullYear() + '-' + Month + '-' + date.getDate() + ' 00:00:00.000';\n        datelist[1] = date.getFullYear() + '-' + Month + '-' + date.getDate() + ' ' + date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds() + '.000';\n        this.form.date = datelist;\n        console.log(this.form.date);\n        this.axios.get(\"/guanqu/table/xingzhen_gongkuang_tree\").then(res => {\n            console.log(res);\n            this.Treedata2 = this.XingZheng_Tree_Filter('650000000000', res.data).data;\n        });\n        // 获取输排水渠道数据,然后设置渠道选择框选项\n        this.axios.get(\"/guanqu/table/qudao_gongkuang_tree\").then(res => {\n            // console.log(res);\n            this.Treedata = this.QuDao_Tree_Filter(res.data).data;\n            this.SiteiNFO.CZMC = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\n            this.SiteiNFO.STCD = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\n            console.log(this.QuDao_Tree_Filter(res.data));\n            // this.searchs = `&STCD=${this.QuDao_Tree_Filter(res.data).siteinfo.canal_code}`;\n            this.Reload();\n            console.log('渠道', this.QuDao_Tree_Filter(res.data));\n        });\n\n    },\n    methods: {\n        sort_change(column) {\n            console.log(column);\n            if (column.order == 'ascending') {\n                this.form.field = column.prop;\n                this.Reload();\n            }\n            if (column.order == 'descending') {\n                this.form.field = column.prop + ' desc';\n                this.Reload();\n            }\n            if (column.order == null) {\n                this.form.field = '';\n                this.Reload();\n            }\n        },\n        Menu_toggle() {\n            this.Menu.show_Controller = !this.Menu.show_Controller;\n            this.show1 = !this.show1;\n            if (this.show1 == true) {\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.Reload();\n            } else {\n                this.span1 = '24';\n                this.span2 = '0';\n                this.data2 = {};\n                this.Reload();\n            }\n        },\n        // 监听动态参数事件处理函数\n        test1(agmt) {\n            this.Menu.show_Controller = !agmt;\n            // this.show1 = agmt;\n            if (agmt) {\n                if(this.span1 == '24'){\n                    this.span2 = '0';\n                    this.asyncExecute();\n                    return\n                }\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.asyncExecute()\n            } else {\n                if(this.span1 == '24'){\n                    this.span2 = '0';\n                    this.asyncExecute();\n                    return;\n                }\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.asyncExecute()\n            }\n        },\n        // 异步刷新，重新绘图\n        asyncExecute(){\n            setTimeout(this.Reload, 100)\n        },\n        qudao_tree(data) {\n            console.log(data);\n            if (data.bj == 0) {\n                this.searchs = '&STCD=' + data.canal_code;\n                this.SiteiNFO.STCD = data.canal_code;\n                this.SiteiNFO.CZMC = data.label;\n                this.Reload();\n            }\n        },\n        xingzheng_tree(data) {\n            console.log(data);\n            if (data.bj == 0) {\n                this.searchs = '&STCD=' + data.ad_cd;\n                this.SiteiNFO.STCD = data.ad_cd;\n                this.SiteiNFO.CZMC = data.title;\n                this.Reload();\n            }\n        },\n        filterNode(value, Treedata, node) {\n            this.filterTreeData.push(node);\n            if (!value) return true;\n            return Treedata.label.indexOf(value) !== -1;\n        },\n        search() {\n            this.filterTreeData = [];\n            this.$refs.tree.filter(this.searchmsg);\n\n            if (this.searchmsg != '') {\n                this.filterTreeData.some((val, index) => {\n                    // console.log(val.expanded,val.data.bj)\n                    if (val.visible && val.data.bj == 0 && val.data.canal_code) {\n                        console.log(val);\n                        val.isCurrent = true;\n                        this.SiteiNFO.STCD = `${val.data.canal_code}`;\n                        this.SiteiNFO.CZMC = val.label;\n                        console.log(\"this.searchmsg\", this.searchmsg)\n                        return true;\n                    } else if (val.visible && val.data.bj == 0 && val.data.ad_cd) {\n                        val.isCurrent = true;\n                        this.SiteiNFO.STCD = `${val.data.ad_cd}`;\n                        this.SiteiNFO.CZMC = val.label;\n                        return true;\n                    }\n                })\n                this.Reload();\n            } else {\n                // this.SiteiNFO.STCD = '';\n                this.Reload();\n            }\n        },\n        timechange(date) {\n            console.log(this.form.date);\n            this.Reload();\n        },\n        cellclick() {\n            var evt = new Object();\n            evt.graphic = new Object();\n            evt.graphic.attributes = this.SiteiNFO;\n\n            evt.graphic.attributes.STNM = this.SiteiNFO.CZMC;\n            evt.graphic.attributes.itype = \"yunxinggongkuang\";\n            evt.graphic.attributes.rowinfo = JSON.parse(JSON.stringify(this.SiteiNFO))\n            evt.graphic.attributes.rowinfo.tableType = {\n                yxgk: \"historyTable\"\n            };\n            var v = new Object;\n            v.itype = \"yunxinggongkuang\";\n            console.log(\"evt\", evt);\n            this.$App.showDrawer(evt, v);\n        },\n        drawchart() {\n            var achart = this.$echarts.init(this.$refs.achart);\n            console.log(achart);\n            achart.resize();\n            achart.setOption({\n                title: {text: \"\"},\n                tooltip: {\n                    trigger: \"axis\"\n                },\n                legend: {\n                    data: [\"电压\"]\n                },\n                calculable: true,\n                xAxis: [\n                    {\n                        type: \"category\",\n                        boundaryGap: false,\n                        data: this.data2.x.list,\n                        axisLabel: {interval: parseInt(this.data2.x.list.length / 3.35), rotate: 50},\n                    }\n                ],\n                grid: { // 控制图的大小，调整下面这些值就可以，\n                    x: 70,\n                    x2: 40,\n                    y2: 100// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上\n                },\n                yAxis: [\n                    {\n                        name: \"电压\",\n                        type: \"value\",\n                        min: this.data2.y1.min,\n                        max: this.data2.y1.max\n                    },\n                ],\n                series: [\n                    {\n                        name: \"电压\",\n                        type: \"line\",\n                        yAxisIndex: 0,\n                        data: this.data2.y1.list\n                        // data: [0.36, 0.28, 0.36, 0.02, 0.12]\n                    },\n                ]\n            });\n        },\n        err() {\n            this.$Message.warning('该功能还在开发中...');\n        },\n        changeTree() {\n            this.qudao = !this.qudao;\n            this.xingzhengquhua = !this.xingzhengquhua;\n        },\n        Reload() {\n            console.log(this.SiteiNFO.STCD);\n            let body = {}\n            body.STCD = this.SiteiNFO.STCD\n            this.$GetData.Survey_Around_YXGK(null, body, false, data => {\n\n                // const around = document.getElementById(`${item.STCD}_VOLMAX_VOLMIN`)\n                let dataVol = data.data[0]\n                this.ZCDY.VOLMIN = dataVol.VOLMIN,\n                    this.ZCDY.VOLMAX = dataVol.VOLMAX\n\n            })\n\n            this.loading = true;\n            this.axios.get(\"/guanqu/lishigongkuang/lishibiao?_page_size=\" + this.list_input.pagesize + \"&_page=\" + this.list_input.current, {\n                params: {\n                    // TM: 'bt,' +  + ',' + this.form.date[1],\n                    _orderby: this.form.field,\n                    STCD: this.SiteiNFO.STCD,\n                    Time_min: this.form.date[0],\n                    Time_max: this.form.date[1],\n                }\n            }).then(res => {\n                console.log(res);\n                this.data1 = res.data.list.reverse();\n                if (res.data.total != 0) {\n                    // this.SiteiNFO.CZMC = res.data.list[0].STNM;\n                    console.log(this.SiteiNFO.CZMC);\n                    // this.STinfo = res.data.list;\n                }\n                this.list_input.total = res.data.total;\n                for (var i = 0; i < this.data1.length; i++) {\n                    this.data1[i].tm = this.dateFilter(this.data1[i].tm);\n                    this.data1[i].VOL = this.Float_Filter(this.data1[i].VOL, 1)\n                }\n                this.loading = false;\n            });\n            this.axios.get(\"/guanqu/lishigongkuang/lishibiao?_page=1&_page_size=99999\", {\n                params: {\n                    // TM: 'bt,' + this.form.date[0] + ',' + this.form.date[1],\n                    STCD: this.SiteiNFO.STCD,\n                    Time_min: this.form.date[0],\n                    Time_max: this.form.date[1],\n                }\n            }).then(res => {\n                this.data2 = res.data.list.reverse();\n                for (var i = 0; i < this.data2.length; i++) {\n                    this.data2[i].tm = this.dateFilter(this.data2[i].tm);\n                }\n                this.data2 = this.transform_YXGK_data_into_ehart_data(this.data2, 'zhuangtaishuju');\n                console.log(this.transform_YXGK_data_into_ehart_data(res.data.list, 'zhuangtaishuju'));\n                this.drawchart();\n                this.data2 = {};\n            });\n            this.axios.get(\"/guanqu/admin/ST_StationStatusType\").then(res => {\n                this.ZCDY = res.data.rows[0];\n            });\n        },\n        indexMethod(index) {\n            return index + 1 + (this.list_input.pagesize * (this.list_input.current - 1));\n        },\n        // 处理页码切换\n        CurrentChange(index) {\n            // console.log(index);\n            this.list_input.current = index;\n            this.Reload();\n        },\n        // 处理每页显示条数切换\n        PagesizeChange(pagesize) {\n            // console.log(pagesize)\n            this.list_input.pagesize = pagesize;\n            this.Reload();\n        }\n    },\n    created() {\n    },\n    computed:{\n      balabala(){\n        //console.log(this.$store.state.anniu);\n        return this.$store.state.anniu\n      }\n    },\n    watch:{\n        // 'this.$store.state.anniu': function(){\n        //     console.log(this.$store.state.anniu);\n        // }\n        balabala(curVal,oldVal){\n          console.log(curVal);\n          this.test1(curVal)\n        }\n    }\n};\n",null]}