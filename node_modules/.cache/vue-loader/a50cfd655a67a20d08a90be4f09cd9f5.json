{"remainingRequest":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work2022\\gvisualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-sendmessage\\warmsend.vue?vue&type=style&index=0&lang=less&scope=true&","dependencies":[{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-sendmessage\\warmsend.vue","mtime":1645514326432},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\less-loader\\dist\\cjs.js","mtime":1642129565717},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.cardcss{\r\n    width:90%;\r\n    margin-left:16px;\r\n}\r\n.footer{\r\nbackground:#fff;\r\ntext-align:center;\r\n}\r\n",{"version":3,"sources":["warmsend.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"warmsend.vue","sourceRoot":"src/warm/warm-manage/warm-sendmessage","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<Content>\r\n            <Card class=\"cardcss\">\r\n            <p slot=\"title\">短信信息输入</p>\r\n            <el-form ref=\"form\" :model=\"form\" label-width=\"100px\" size=\"small\">\r\n                <el-form-item label=\"发送平台：\">\r\n                    <RadioGroup v-model=\"form.plan\">\r\n                        <Radio v-for=\"item in planlist\" :label=\"item.value\" size=\"large\" name=\"plans\">{{item.label}}</Radio>\r\n                    </RadioGroup>\r\n                </el-form-item>\r\n                <el-form-item label=\"人员类型：\">\r\n                    <Checkbox v-for=\"item in typelist\" :label=\"item.value\"  :name=\"item.value\" size=\"large\" @on-change=\"checkone(item.value,$event)\">{{item.label}}</Checkbox>\r\n                </el-form-item>\r\n                <el-form-item label=\"手机号码：\">\r\n                    <Input v-model=\"form.phone\" :value=\"form.phone\" clearable style=\"width:98%\"/>\r\n                    <div style=\"color:red;font-size:11px;\">(手机号码之间请用英文标点“,”隔开)</div>\r\n                </el-form-item>\r\n                <el-form-item label=\"短信内容：\">\r\n                    <Input type=\"textarea\" v-model=\"form.content\" :rows=\"4\" :value=\"form.content\" clearable style=\"width:98%\" />\r\n                    <div style=\"color:red;font-size:11px;\">(短信内容不超过70个汉字)</div>\r\n                </el-form-item>\r\n            </el-form>\r\n            <Footer class=\"footer\">\r\n            <Button  type=\"primary\" @click=\"onSubmit\" icon=\"md-cloud-upload\" size=\"large\">发送</Button>\r\n            <Button  @click=\"onClear\" style=\"margin-left:20px;\" icon=\"md-trash\" size=\"large\">清空</Button>\r\n            </Footer>\r\n            </Card>\r\n        </Content>\r\n    </div>\r\n</template>\r\n<script type=\"text/javascript\">\r\n        import WarmDataConfig from \"@/assets/commonJS/WarmDataConfig\";\r\n\texport default {\r\n        props: {\r\n            maninfo: {}\r\n        },\r\n        data(){\r\n            return{\r\n                social:[],\r\n                planlist:[],\r\n                typelist:[],\r\n                form:{\r\n                    plan:'',\r\n                    phone:'',\r\n                    name:'',\r\n                    content:'',\r\n                    allinfo:[]\r\n                },\r\n            }\r\n        },\r\n        // 引入过滤方法到此组件\r\n        mixins: [WarmDataConfig],\r\n        mounted(){\r\n            this.Reload();\r\n        },\r\n        methods:{\r\n            Reload(){\r\n                this.Get_SysForminfo('DXFS20190921',1,data => {\r\n                    this.planlist = data;\r\n                    this.form.plan=data[0].value;\r\n                });\r\n                this.Get_WrpFieldinfo('WRP_MAN','TYPES',data => {\r\n                    this.typelist = data;\r\n                    this.form.allinfo=new Array();\r\n                    for(var i=0;i<this.typelist.length;i++){\r\n                        var info=new Object();\r\n                        info.type=this.typelist[i].value;\r\n                        info.title=this.typelist[i].label;\r\n                        info.itype=\"fasongrenyuan\";\r\n                        info.list=new Array();\r\n                        this.form.allinfo.push(info);\r\n                    }\r\n                });\r\n            },\r\n            //选择人员\r\n            checkone(val,event){\r\n                if(event){\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n                            this.$emit('showdailog', this.form.allinfo[i]);\r\n                        }\r\n                    }\r\n                }else{\r\n                    var typephone=\"\";\r\n                    this.form.phone+=\",\";\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n\r\n                            for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                                typephone+=this.form.allinfo[i].list[t].MOBILE+\",\"; \r\n                                 this.form.phone=this.form.phone.replace(this.form.allinfo[i].list[t].MOBILE+\",\",\"\");                         \r\n                            }\r\n                            this.form.allinfo[i].list=new Array();\r\n                            break;\r\n                        }\r\n                    }\r\n                    this.form.phone=this.form.phone.substr(0,this.form.phone.length-1);\r\n                }\r\n            },\r\n           //设置手机号码\r\n           showphone(dataobj){\r\n               var phonestr=\"\";\r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(dataobj.type==this.form.allinfo[i].type){\r\n                            this.form.allinfo[i].list=dataobj.list;\r\n                            for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                                phonestr+=this.form.allinfo[i].list[t].MOBILE+\",\";\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                if(phonestr!=\"\"){\r\n                    if(this.form.phone==\"\"){\r\n                        this.form.phone+=phonestr.substr(0,phonestr.length-1);\r\n                    }else{\r\n                        this.form.phone+=\",\"+phonestr.substr(0,phonestr.length-1); \r\n                    }\r\n                }\r\n                \r\n                \r\n           },\r\n           //取消复选框选中\r\n           cancelcheck(val){\r\n               document.getElementsByName(val)[0].click();\r\n           },\r\n           onSubmit(){\r\n            if(this.form.phone==\"\"){\r\n                this.$message({message:'请选择要发送短信的人员或输入手机号码！',type:'warning'});\r\n                return;\r\n            }\r\n            var myreg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/;\r\n            var phones=this.form.phone.split(\",\");\r\n            for(var h=0;h<phones.length;h++){\r\n                if(!(myreg.test(phones[h]))){ \r\n                    this.$message({message:'手机号码 “'+phones[h]+'” 异常！',type:'warning'});  \r\n                    return; \r\n                }\r\n            }\r\n            var str=this.form.content;\r\n            if(str.replace(\" \",\"\")==\"\"){\r\n                this.$message({message:'请输入短信内容！',type:'warning'});\r\n                return;\r\n            }\r\n            if(this.strlen(str)>=140){\r\n                this.$message({message:'短信内容不能超过70个汉字！',type:'warning'});\r\n                return;\r\n            }\r\n            var appid=\"普通短信\";\r\n            var sender=\"\";\r\n            var tablename=this.form.plan;\r\n            for(var t=0;t<this.planlist.length;t++){\r\n                if(this.form.plan==this.planlist[t].value){\r\n                    sender=this.planlist[t].label;\r\n                    break;\r\n                }\r\n            }\r\n            var content=this.form.content;\r\n\r\n            var sendlen=phones.length;\r\n            var count=0;\r\n            for(var s=0;s<sendlen;s++){\r\n                var sign=0;\r\n                for(var i=0;i<this.form.allinfo.length;i++){\r\n                    if(this.form.allinfo[i].list.length>0){\r\n                        for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                            var receiver=this.form.allinfo[i].list[t].MOBILE;\r\n                            var addtion1=this.form.allinfo[i].list[t].NM;\r\n                            var addtion2=this.form.allinfo[i].list[t].UNIT;\r\n                            var addtion3=this.form.allinfo[i].list[t].ZW; \r\n                         if(phones[s]==receiver){\r\n                            sign=1;                       \r\n                            let postData=new Object();\r\n                            postData[\"appid\"]=appid;\r\n                            postData[\"sender\"]=sender;\r\n                            postData[\"tablename\"]=tablename;\r\n                            postData[\"receiver\"]=receiver;\r\n                            postData[\"addtion1\"]=addtion1;\r\n                            postData[\"addtion2\"]=addtion2;\r\n                            postData[\"addtion3\"]=addtion3;\r\n                            postData[\"content\"]=content;\r\n                            this.axios.post('/alarm/addmessage',postData).then((res)=>{\r\n                                if(res.data==\"ok\"){\r\n                                    count+=1;\r\n                                }                   \r\n                            });\r\n                          } \r\n                        }\r\n                    }\r\n                }\r\n                if(sign==0){\r\n                    let postData=new Object();\r\n                            postData[\"appid\"]=appid;\r\n                            postData[\"sender\"]=sender;\r\n                            postData[\"tablename\"]=tablename;\r\n                            postData[\"receiver\"]=phones[s];\r\n                            postData[\"addtion1\"]=\"\";\r\n                            postData[\"addtion2\"]=\"\";\r\n                            postData[\"addtion3\"]=\"\";\r\n                            postData[\"content\"]=content;\r\n                            this.axios.post('/alarm/addmessage',postData).then((res)=>{\r\n                                if(res.data==\"ok\"){\r\n                                    count+=1;\r\n                                }                   \r\n                            });\r\n                }\r\n            }\r\n              var successtime=  setInterval(() => {\r\n                    if(sendlen==count){\r\n                        this.$message({message:'短信发送成功！',type:'success'});\r\n                        clearInterval(successtime);\r\n                        this.onClear();\r\n                    }\r\n                }, 500);\r\n           },\r\n           onClear(){\r\n               this.form.plan=this.planlist[0].value;\r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                   var box=document.getElementsByName(this.form.allinfo[i].type);\r\n                   if (box[0].checked==true) {\r\n                      box[0].click();\r\n                   }\r\n               }\r\n                this.form.phone=\"\";\r\n                this.form.content=\"\";\r\n           } \r\n        }\r\n    }\r\n</script>\r\n<style lang=\"less\" scope>\r\n.cardcss{\r\n    width:90%;\r\n    margin-left:16px;\r\n}\r\n.footer{\r\nbackground:#fff;\r\ntext-align:center;\r\n}\r\n</style>\r\n"]}]}