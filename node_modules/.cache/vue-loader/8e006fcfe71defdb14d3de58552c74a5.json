{"remainingRequest":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work2022\\gvisualplace\\zhihuiguanqu\\src\\table\\table-hdsq\\table-history.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\src\\table\\table-hdsq\\table-history.vue","mtime":1577669404050},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\gvisualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport FilterMethods from \"@/assets/commonJS/FilterMethods\";\nimport GetDataMethods from \"@/assets/commonJS/GetDataMethods\";\nimport App from \"@/App.vue\";\n\nexport default {\n    data() {\n        return {\n            loading: false,\n            qudao: true,\n            xingzhengquhua: false,\n            show1: true,\n            Menu: {show_Controller: false},\n            span1: '19',\n            span2: '5',\n            Treedata: [\n                {\n                    title: \"xxx灌区\",\n                    expand: true,\n                    children: [\n                        {\n                            title: \"xxx渠道\",\n                            expand: true,\n                            children: [\n                                {\n                                    title: \"站点A\"\n                                },\n                                {\n                                    title: \"站点B\"\n                                }\n                            ]\n                        },\n                        {\n                            title: \"xxx渠道\",\n\n                            children: [\n                                {\n                                    title: \"站点C\"\n                                }\n                            ]\n                        },\n                        {\n                            title: \"xxx渠道\",\n\n                            children: [\n                                {\n                                    title: \"站点D\"\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ],\n            Treedata2: [],\n            GD: '',\n            data1: [],\n            data2: [],\n            changebtn: '切换线形图',\n            date: '',\n            STinfo: {},\n            searchs: \"\",\n            timesearch: '',\n            CZMC: '',\n            A_AWL: '',\n            echarts: {\n                TM: [],\n                Q: [],\n                UPZ: [],\n                DWZ: [],\n            },\n            form: {\n                searchmsg: '',\n                date: '',\n                field: '',\n            },\n            searchmsg: '',\n            MaxY1: 0,\n            MaxY2: 0,\n            MinY1: 0,\n            MinY2: 0,\n            list_input: {\n                total: 100,\n                pagesize: 50,\n                pagesizeopts: [10, 20, 50, 75, 100, 200],\n                current: 1\n            }\n        };\n    },\n    // 引入过滤方法到此组件\n    mixins: [FilterMethods, GetDataMethods],\n    // watch: {\n    //   searchmsg(val) {\n    //     this.$refs.tree.filter(val);\n    //   }\n    // },\n    mounted() {\n        var date = new Date();\n        var Month = date.getMonth() + 1;\n        var datelist = new Array();\n        var Hours = date.getHours();\n        var Minutes = date.getMinutes();\n        var Seconds = date.getSeconds();\n        if (Hours < 10) {\n            Hours = `0${Hours}`\n        }\n        if (Minutes < 10) {\n            Minutes = `0${Minutes}`\n        }\n        if (Seconds < 10) {\n            Seconds = `0${Seconds}`\n        }\n        if (Month < 10) {\n            Month = `0${Month}`\n        }\n        datelist[0] = `${date.getFullYear()}-${Month}-${date.getDate()} 00:00:00`;\n        datelist[1] = `${date.getFullYear()}-${Month}-${date.getDate()} ${Hours}:${Minutes}:${Seconds}`;\n        this.form.date = datelist;\n        console.log(this.form.date);\n        this.axios.get(\"/guanqu/table/xingzhen_tree?type=3\").then(res => {\n            console.log(res);\n            this.Treedata2 = this.XingZheng_Tree_Filter('650000000000', res.data).data;\n        });\n        //获取输排水渠道数据,然后设置渠道选择框选项\n        this.axios.get(\"/guanqu/table/qudao_tree?type=3\").then(res => {\n            this.Treedata = this.QuDao_Tree_Filter(res.data).data;\n            this.CZMC = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\n            // this.searchs = `&STCD=${this.QuDao_Tree_Filter(res.data).siteinfo.canal_code}`;\n            this.STinfo.STNM = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\n            this.STinfo.STCD = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\n            this.searchs = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\n            this.Reload();\n            console.log('渠道', this.QuDao_Tree_Filter(res.data));\n        });\n        // this.Reload();\n    },\n    methods: {\n        sort_change(column) {\n            console.log(column);\n            if (column.order == 'ascending') {\n                this.form.field = column.prop;\n                this.Reload();\n            }\n            if (column.order == 'descending') {\n                this.form.field = column.prop + ' desc';\n                this.Reload();\n            }\n            if (column.order == null) {\n                this.form.field = '';\n                this.Reload();\n            }\n        },\n        Menu_toggle() {\n            this.Menu.show_Controller = !this.Menu.show_Controller;\n            this.show1 = !this.show1;\n            if (this.show1 == true) {\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.Reload();\n            } else {\n                this.span1 = '24';\n                this.span2 = '0';\n                this.data2 = {};\n                this.Reload();\n            }\n        },\n\n        // 监听动态参数事件处理函数\n        test1(agmt) {\n            this.Menu.show_Controller = !agmt;\n            // this.show1 = agmt;\n            if (agmt) {\n                if(this.span1 == '24'){\n                    this.span2 = '0';\n                    this.asyncExecute();\n                    return\n                }\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.asyncExecute()\n            } else {\n                if(this.span1 == '24'){\n                    this.span2 = '0';\n                    this.asyncExecute();\n                    return;\n                }\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.asyncExecute()\n            }\n        },\n        // 异步刷新，重新绘图\n        asyncExecute(){\n            setTimeout(this.Reload, 100)\n        },\n        qudao_tree(data) {\n            console.log(data);\n            if (data.bj == 0) {\n                this.searchs = data.canal_code;\n                this.STinfo = data;\n                this.CZMC = data.label.replace('【站点】', '');\n                this.Reload();\n            }\n        },\n        xingzheng_tree(data) {\n            console.log(data);\n            if (data.bj == 0) {\n                this.searchs = data.ad_cd;\n                this.STinfo = data;\n                this.CZMC = data[0].title.replace('【站点】', '');\n                this.Reload();\n            }\n        },\n        filterNode(value, Treedata, node) {\n            this.filterTreeData.push(node);\n            if (!value) return true;\n            return Treedata.label.indexOf(value) !== -1;\n        },\n        search() {\n            // console.log(this.searchmsg);\n            this.filterTreeData = [];\n            this.$refs.tree.filter(this.searchmsg);\n\n            // console.log(\"filterTreeData\",this.filterTreeData)\n            if (this.searchmsg != '') {\n                this.filterTreeData.some((val, index) => {\n                    // console.log(val.expanded,val.data.bj)\n                    if (val.visible && val.data.bj == '0' && val.data.canal_code) {\n                        console.log('++++++++++++++++++', val);\n                        val.isCurrent = true;\n                        this.STinfo = val.data;\n                        this.searchs = val.data.canal_code;\n                        this.CZMC = val.label.replace('【站点】', '');\n                        console.log(\"this.searchmsg\", this.searchmsg)\n                        return true;\n                    } else if (val.visible && val.data.bj == '0' && val.data.ad_cd) {\n                        console.log(val)\n                        val.isCurrent = true;\n                        this.STinfo = val.data;\n                        this.searchs = val.data.ad_cd;\n                        this.CZMC = val.label.replace('【站点】', '');\n                        return true;\n                    }\n                });\n                this.Reload();\n            } else {\n                this.STinfo.STCD = '';\n                this.Reload();\n            }\n        },\n        timechange() {\n            console.log(this.form.date);\n            this.Reload();\n        },\n        cellclick() {\n            console.log(JSON.stringify(this.STinfo));\n            if (JSON.stringify(this.STinfo) == \"{}\") {\n                this.$Message.warning('请先选择站点');\n            } else {\n                if (this.STinfo.bj) {\n                    this.STinfo.STCD = this.STinfo.canal_code\n                    this.STinfo.STNM = this.STinfo.canal_name\n                }\n                var evt = new Object();\n                evt.graphic = new Object();\n                evt.graphic.attributes = this.STinfo;\n                console.log(this.STinfo);\n                // evt.graphic.attributes.STNM = this.CZMC;\n                // evt.graphic.attributes.STCD = this.STinfo.STCD;\n                evt.graphic.attributes.itype = \"hedaoshuiqing\";\n                evt.graphic.attributes.rowinfo = JSON.parse(JSON.stringify(this.STinfo))\n                evt.graphic.attributes.rowinfo.tableType = {\n                    hdsq: \"historyTable\"\n                };\n                var v = new Object;\n                v.itype = \"hedaoshuiqing\";\n                console.log(\"evt\", evt);\n                this.$App.showDrawer(evt, v);\n            }\n\n        },\n        drawchart() {\n            var achart = this.$echarts.init(this.$refs.achart);\n            console.log(achart);\n            achart.resize();\n            achart.setOption({\n                title: {text: \"\"},\n                tooltip: {\n                    trigger: \"axis\"\n                },\n                legend: {\n                    data: [\"流量\", \"水位\"]\n                },\n                calculable: true,\n                xAxis: [\n                    {\n                        type: \"category\",\n                        boundaryGap: false,\n                        data: this.data2.x.list.reverse(),\n                        axisLabel: {interval: parseInt(this.data2.x.list.length / 3.2), rotate: 50},\n                    }\n                ],\n                grid: { // 控制图的大小，调整下面这些值就可以，\n                    x: 70,\n                    x2: 40,\n                    y2: 100// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上\n                },\n                yAxis: [\n                    {\n                        name: \"流量\",\n                        type: \"value\",\n                        min: this.data2.y1.min,\n                        max: this.data2.y1.max\n                    },\n                    {\n                        name: \"水位\",\n                        type: \"value\",\n                        min: this.data2.y2.min,\n                        max: this.data2.y2.max\n                    }\n                ],\n                series: [\n                    {\n                        name: \"水位\",\n                        type: \"line\",\n                        yAxisIndex: 1,\n                        data: this.data2.y1.list.reverse(),\n                    },\n                    {\n                        name: \"流量\",\n                        type: \"line\",\n                        yAxisIndex: 0,\n                        data: this.data2.y2.list.reverse(),\n                        itemStyle: {\n                            normal: {\n                                color: \"#006400\",//折线点的颜色\n                                lineStyle: {\n                                    color: \"#006400\"//折线的颜色\n                                }\n                            }\n                        },\n                        // data: [0.36, 0.28, 0.36, 0.02, 0.12]\n                    },\n                ]\n            });\n        },\n        err() {\n            this.$Message.warning('该功能还在开发中...');\n        },\n        changeTree() {\n            this.qudao = !this.qudao;\n            this.xingzhengquhua = !this.xingzhengquhua;\n        },\n        Reload() {\n            this.loading = true;\n            this.axios.get(\"/guanqu/hedaoshuiqing/lishi_lishibiao?_page_size=\" + this.list_input.pagesize + \"&_page=\" + this.list_input.current, {\n                params: {\n                    Time_min: this.form.date[0].substr(0, 19),\n                    STCD: this.searchs,\n                    STNM: this.CZMZ,\n                    Time_max: this.form.date[1].substr(0, 19)\n                }\n            }).then(res => {\n                console.log(res);\n                this.data1 = res.data.list;\n                if (res.data.total != 0) {\n                    // this.CZMC = res.data.list[0].STNM;\n                    // this.STinfo = res.data.list[0];\n                }\n                this.list_input.total = res.data.list.length;\n                this.loading = false;\n                for (var i = 0; i < this.data1.length; i++) {\n                    this.data1[i].Q = this.Z_Filter(this.data1[i].Q, 3);\n                    this.data1[i].Z = this.Z_Filter(this.data1[i].Z);\n                    this.data1[i].AWL = this.Z_Filter(this.data1[i].AWL);\n\n                    console.log(this.data1[i].Z > this.data1[i].AWL);\n                }\n            });\n            this.axios.get(\"/guanqu/hedaoshuiqing/lishi_lishibiao?_page=1&_page_size=99999\", {\n                params: {\n                    Time_min: this.form.date[0].substr(0, 19),\n                    STCD: this.searchs,\n                    STNM: this.CZMZ,\n                    Time_max: this.form.date[1].substr(0, 19)\n                }\n            }).then(res => {\n                this.data2 = res.data.list;\n                this.data2 = this.transform_HDSQ_data_into_ehart_data(this.data2, 'historyTable');\n                console.log(this.data2);\n                this.drawchart();\n            });\n            // 警戒水位\n            this.axios.get('/guanqu/table/ST_RIVER_Alarm?STCD=' + this.STinfo.STCD).then(res => {\n                console.log(res);\n                res = res.data.list[0];\n                console.log(res.AWL);\n                // 设置保留小数\n                let strItem = res.AWL.toString().split('.');\n                if (strItem[1] === undefined) {\n                    res.AWL = `${res.AWL}.00`;\n                } else if (strItem[1].length === 1) {\n                    res.AWL = `${res.AWL}0`;\n                } else if (strItem[1].length >= 3) {\n                    res.AWL = item.substring(0, res.AWL.length - 1);\n                } else {\n                    res.AWL = res.AWL\n                }\n                console.log(res.AWL);\n                this.A_AWL = res.AWL\n            })\n        },\n        indexMethod(index) {\n            return index + 1 + (this.list_input.pagesize * (this.list_input.current - 1));\n        },\n        // 处理页码切换\n        CurrentChange(index) {\n            // console.log(index);\n            this.list_input.current = index;\n            this.Reload();\n        },\n        // 处理每页显示条数切换\n        PagesizeChange(pagesize) {\n            // console.log(pagesize)\n            this.list_input.pagesize = pagesize;\n            this.Reload();\n        },\n\n    },\n    computed: {\n        balabala() {\n            //console.log(this.$store.state.anniu);\n            return this.$store.state.anniu\n        }\n    },\n    watch: {\n        // 'this.$store.state.anniu': function(){\n        //   console.log(this.$store.state.anniu);\n        // }\n        balabala(curVal, oldVal) {\n            console.log(curVal);\n            this.test1(curVal)\n        }\n    },\n    created() {\n    }\n};\n",{"version":3,"sources":["table-history.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwJA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"table-history.vue","sourceRoot":"src/table/table-hdsq","sourcesContent":["<template>\r\n    <div>\r\n        <Content :style=\"{padding: '24px', background: '#fff'}\">\r\n            <Row :gutter=\"16\">\r\n                <Col :span=\"span1\">\r\n                    <Row :gutter=\"16\" type=\"flex\" justify=\"start\" z style=\"margin: 10px;line-height: 32px;\">\r\n                        <Col>\r\n                            时间:\r\n                            <el-date-picker\r\n                                    v-model=\"form.date\"\r\n                                    type=\"datetimerange\"\r\n                                    range-separator=\"至\"\r\n                                    start-placeholder=\"开始日期\"\r\n                                    end-placeholder=\"结束日期\"\r\n                                    align=\"right\"\r\n                                    @change=\"timechange\"\r\n                                    value-format=\"yyyy-MM-dd HH:mm:ss\"\r\n                                    :clearable=\"false\"\r\n                                    size=\"small\"\r\n                                    style=\"width: 340px\"\r\n                                    width=\"200\"\r\n                            >\r\n                            </el-date-picker>\r\n                        </Col>\r\n                        <Col>\r\n                            <Button type=\"primary\" style=\"width: auto;margin-right: 10px;\" @click=\"cellclick\">站点详情\r\n                            </Button>\r\n                            <!-- <Button type=\"primary\" style=\"width: auto;margin-right: 0px;margin-left: 10px;\" @click=\"test1\">显示/隐藏树形</Button> -->\r\n                        </Col>\r\n                        <Col>\r\n                            <Button type=\"primary\" style=\"width: auto;margin-right: 20px;margin-left: 10px;\"\r\n                                    @click=\"err\">导出\r\n                            </Button>\r\n                        </Col>\r\n                    </Row>\r\n                    <div class=\"switch\" @click=\"Menu_toggle\">\r\n                        <i class=\"el-icon-d-arrow-left\" v-if=\"Menu.show_Controller\"></i>\r\n                        <i class=\"el-icon-d-arrow-right\" v-if=\"!Menu.show_Controller\"></i>\r\n                    </div>\r\n                    <Divider/>\r\n                    <Row>\r\n                        <!-- <Col style=\"text-align: center;margin: 0 0 10px 0;\">\r\n                            监测站名：{{CZMC}}\r\n                        </Col> -->\r\n                        <Col style='font-size: 14px;' class=\"borsLine\">站名：{{CZMC}}，\r\n                            水位：m，累计流量 m³/s\r\n                        </Col>\r\n                    </Row>\r\n                    <Row :gutter=\"24\" style=\"display: flex;\">\r\n                        <Col style=\"width: 600px;\">\r\n                            <el-table\r\n                                    :data=\"data1\"\r\n                                    border\r\n                                    height=\"500\"\r\n                                    v-loading=\"loading\"\r\n                                    @sort-change=\"sort_change\"\r\n                                    style=\"width: 600px\">\r\n                                <el-table-column\r\n                                        label=\" \"\r\n                                        type=\"index\"\r\n                                        align=\"center\"\r\n                                        width=\"60\"\r\n                                        :index=\"indexMethod\">\r\n                                </el-table-column>\r\n                                <el-table-column\r\n                                        prop=\"tm\"\r\n                                        label=\"时间\"\r\n                                        sortable=\"custom\"\r\n                                        align=\"center\">\r\n                                </el-table-column>\r\n                                <el-table-column\r\n                                        label=\"水位\"\r\n                                        sortable=\"custom\"\r\n                                        align=\"center\"\r\n                                >\r\n                                    <template slot-scope=\"scope\">\r\n                                        <div>\r\n                              <span :style=\"{color: scope.row.Z > scope.row.AWL? 'red' : 'black'}\">\r\n                                  {{ scope.row.Z }}\r\n                              </span>\r\n                                        </div>\r\n                                    </template>\r\n                                </el-table-column>\r\n                                <el-table-column\r\n                                        prop=\"Q\"\r\n                                        label=\"流量\"\r\n                                        sortable=\"custom\"\r\n                                        align=\"center\"\r\n                                >\r\n                                </el-table-column>\r\n                            </el-table>\r\n                            <div style=\"margin: 10px;overflow: hidden\">\r\n                                <div style=\"float: right;\">\r\n                                    <Page\r\n                                            :total=\"list_input.total\"\r\n                                            :current=\"list_input.current\"\r\n                                            show-sizer\r\n                                            :page-size=\"list_input.pagesize\"\r\n                                            :page-size-opts=\"list_input.pagesizeopts\"\r\n                                            @on-change=\"CurrentChange\"\r\n                                            @on-page-size-change=\"PagesizeChange\"\r\n                                            size=\"small\"\r\n                                            show-total\r\n                                            show-elevator\r\n                                    ></Page>\r\n                                </div>\r\n                            </div>\r\n                        </Col>\r\n                        <Col span=\"12\">\r\n                            <div ref=\"achart\"\r\n                                 style=\"width: 100%;height: 400px;margin-top: 1%;margin-bottom: 50px;\"></div>\r\n                        </Col>\r\n                    </Row>\r\n                </Col>\r\n                <transition name=\"el-fade-in-linear\">\r\n                    <Col :span=\"span2\" v-show=\"show1\">\r\n                        <Row style=\"margin-top: 10px;line-height: 32px;\">\r\n                            <Col>\r\n                                <Input search enter-button suffix=\"ios-search\" placeholder=\"请输入站名\" style=\"width: auto;margin-right: 20px;\" @on-search=\"search\" v-model=\"searchmsg\" />\r\n                            </Col>\r\n                        </Row>\r\n                        <Row style=\"margin-top: 30px;margin-left: 20px;\">\r\n                            <Col style=\"max-height: 600px;overflow-y: auto;\">\r\n                                <Button shape=\"circle\" @click=\"changeTree\">切换树形图</Button>\r\n                                <el-tree\r\n                                        class=\"filter-tree\"\r\n                                        :data=\"Treedata2\"\r\n\r\n                                        :filter-node-method=\"filterNode\"\r\n                                        v-if=\"xingzhengquhua\"\r\n                                        @node-click=\"xingzheng_tree\"\r\n                                        ref=\"tree\">\r\n                                </el-tree>\r\n                                <el-tree\r\n                                        class=\"filter-tree\"\r\n                                        :data=\"Treedata\"\r\n\r\n                                        :filter-node-method=\"filterNode\"\r\n                                        v-if=\"qudao\"\r\n                                        @node-click=\"qudao_tree\"\r\n                                        ref=\"tree\">\r\n                                </el-tree>\r\n                            </Col>\r\n                        </Row>\r\n                    </Col>\r\n                </transition>\r\n            </Row>\r\n        </Content>\r\n    </div>\r\n</template>\r\n\r\n<script type=\"text/javascript\">\r\n    import FilterMethods from \"@/assets/commonJS/FilterMethods\";\r\n    import GetDataMethods from \"@/assets/commonJS/GetDataMethods\";\r\n    import App from \"@/App.vue\";\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n                loading: false,\r\n                qudao: true,\r\n                xingzhengquhua: false,\r\n                show1: true,\r\n                Menu: {show_Controller: false},\r\n                span1: '19',\r\n                span2: '5',\r\n                Treedata: [\r\n                    {\r\n                        title: \"xxx灌区\",\r\n                        expand: true,\r\n                        children: [\r\n                            {\r\n                                title: \"xxx渠道\",\r\n                                expand: true,\r\n                                children: [\r\n                                    {\r\n                                        title: \"站点A\"\r\n                                    },\r\n                                    {\r\n                                        title: \"站点B\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            {\r\n                                title: \"xxx渠道\",\r\n\r\n                                children: [\r\n                                    {\r\n                                        title: \"站点C\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            {\r\n                                title: \"xxx渠道\",\r\n\r\n                                children: [\r\n                                    {\r\n                                        title: \"站点D\"\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ],\r\n                Treedata2: [],\r\n                GD: '',\r\n                data1: [],\r\n                data2: [],\r\n                changebtn: '切换线形图',\r\n                date: '',\r\n                STinfo: {},\r\n                searchs: \"\",\r\n                timesearch: '',\r\n                CZMC: '',\r\n                A_AWL: '',\r\n                echarts: {\r\n                    TM: [],\r\n                    Q: [],\r\n                    UPZ: [],\r\n                    DWZ: [],\r\n                },\r\n                form: {\r\n                    searchmsg: '',\r\n                    date: '',\r\n                    field: '',\r\n                },\r\n                searchmsg: '',\r\n                MaxY1: 0,\r\n                MaxY2: 0,\r\n                MinY1: 0,\r\n                MinY2: 0,\r\n                list_input: {\r\n                    total: 100,\r\n                    pagesize: 50,\r\n                    pagesizeopts: [10, 20, 50, 75, 100, 200],\r\n                    current: 1\r\n                }\r\n            };\r\n        },\r\n        // 引入过滤方法到此组件\r\n        mixins: [FilterMethods, GetDataMethods],\r\n        // watch: {\r\n        //   searchmsg(val) {\r\n        //     this.$refs.tree.filter(val);\r\n        //   }\r\n        // },\r\n        mounted() {\r\n            var date = new Date();\r\n            var Month = date.getMonth() + 1;\r\n            var datelist = new Array();\r\n            var Hours = date.getHours();\r\n            var Minutes = date.getMinutes();\r\n            var Seconds = date.getSeconds();\r\n            if (Hours < 10) {\r\n                Hours = `0${Hours}`\r\n            }\r\n            if (Minutes < 10) {\r\n                Minutes = `0${Minutes}`\r\n            }\r\n            if (Seconds < 10) {\r\n                Seconds = `0${Seconds}`\r\n            }\r\n            if (Month < 10) {\r\n                Month = `0${Month}`\r\n            }\r\n            datelist[0] = `${date.getFullYear()}-${Month}-${date.getDate()} 00:00:00`;\r\n            datelist[1] = `${date.getFullYear()}-${Month}-${date.getDate()} ${Hours}:${Minutes}:${Seconds}`;\r\n            this.form.date = datelist;\r\n            console.log(this.form.date);\r\n            this.axios.get(\"/guanqu/table/xingzhen_tree?type=3\").then(res => {\r\n                console.log(res);\r\n                this.Treedata2 = this.XingZheng_Tree_Filter('650000000000', res.data).data;\r\n            });\r\n            //获取输排水渠道数据,然后设置渠道选择框选项\r\n            this.axios.get(\"/guanqu/table/qudao_tree?type=3\").then(res => {\r\n                this.Treedata = this.QuDao_Tree_Filter(res.data).data;\r\n                this.CZMC = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\r\n                // this.searchs = `&STCD=${this.QuDao_Tree_Filter(res.data).siteinfo.canal_code}`;\r\n                this.STinfo.STNM = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\r\n                this.STinfo.STCD = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\r\n                this.searchs = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\r\n                this.Reload();\r\n                console.log('渠道', this.QuDao_Tree_Filter(res.data));\r\n            });\r\n            // this.Reload();\r\n        },\r\n        methods: {\r\n            sort_change(column) {\r\n                console.log(column);\r\n                if (column.order == 'ascending') {\r\n                    this.form.field = column.prop;\r\n                    this.Reload();\r\n                }\r\n                if (column.order == 'descending') {\r\n                    this.form.field = column.prop + ' desc';\r\n                    this.Reload();\r\n                }\r\n                if (column.order == null) {\r\n                    this.form.field = '';\r\n                    this.Reload();\r\n                }\r\n            },\r\n            Menu_toggle() {\r\n                this.Menu.show_Controller = !this.Menu.show_Controller;\r\n                this.show1 = !this.show1;\r\n                if (this.show1 == true) {\r\n                    this.span1 = '19';\r\n                    this.span2 = '5';\r\n                    this.data2 = {};\r\n                    this.Reload();\r\n                } else {\r\n                    this.span1 = '24';\r\n                    this.span2 = '0';\r\n                    this.data2 = {};\r\n                    this.Reload();\r\n                }\r\n            },\r\n\r\n            // 监听动态参数事件处理函数\r\n            test1(agmt) {\r\n                this.Menu.show_Controller = !agmt;\r\n                // this.show1 = agmt;\r\n                if (agmt) {\r\n                    if(this.span1 == '24'){\r\n                        this.span2 = '0';\r\n                        this.asyncExecute();\r\n                        return\r\n                    }\r\n                    this.span1 = '19';\r\n                    this.span2 = '5';\r\n                    this.data2 = {};\r\n                    this.asyncExecute()\r\n                } else {\r\n                    if(this.span1 == '24'){\r\n                        this.span2 = '0';\r\n                        this.asyncExecute();\r\n                        return;\r\n                    }\r\n                    this.span1 = '19';\r\n                    this.span2 = '5';\r\n                    this.data2 = {};\r\n                    this.asyncExecute()\r\n                }\r\n            },\r\n            // 异步刷新，重新绘图\r\n            asyncExecute(){\r\n                setTimeout(this.Reload, 100)\r\n            },\r\n            qudao_tree(data) {\r\n                console.log(data);\r\n                if (data.bj == 0) {\r\n                    this.searchs = data.canal_code;\r\n                    this.STinfo = data;\r\n                    this.CZMC = data.label.replace('【站点】', '');\r\n                    this.Reload();\r\n                }\r\n            },\r\n            xingzheng_tree(data) {\r\n                console.log(data);\r\n                if (data.bj == 0) {\r\n                    this.searchs = data.ad_cd;\r\n                    this.STinfo = data;\r\n                    this.CZMC = data[0].title.replace('【站点】', '');\r\n                    this.Reload();\r\n                }\r\n            },\r\n            filterNode(value, Treedata, node) {\r\n                this.filterTreeData.push(node);\r\n                if (!value) return true;\r\n                return Treedata.label.indexOf(value) !== -1;\r\n            },\r\n            search() {\r\n                // console.log(this.searchmsg);\r\n                this.filterTreeData = [];\r\n                this.$refs.tree.filter(this.searchmsg);\r\n\r\n                // console.log(\"filterTreeData\",this.filterTreeData)\r\n                if (this.searchmsg != '') {\r\n                    this.filterTreeData.some((val, index) => {\r\n                        // console.log(val.expanded,val.data.bj)\r\n                        if (val.visible && val.data.bj == '0' && val.data.canal_code) {\r\n                            console.log('++++++++++++++++++', val);\r\n                            val.isCurrent = true;\r\n                            this.STinfo = val.data;\r\n                            this.searchs = val.data.canal_code;\r\n                            this.CZMC = val.label.replace('【站点】', '');\r\n                            console.log(\"this.searchmsg\", this.searchmsg)\r\n                            return true;\r\n                        } else if (val.visible && val.data.bj == '0' && val.data.ad_cd) {\r\n                            console.log(val)\r\n                            val.isCurrent = true;\r\n                            this.STinfo = val.data;\r\n                            this.searchs = val.data.ad_cd;\r\n                            this.CZMC = val.label.replace('【站点】', '');\r\n                            return true;\r\n                        }\r\n                    });\r\n                    this.Reload();\r\n                } else {\r\n                    this.STinfo.STCD = '';\r\n                    this.Reload();\r\n                }\r\n            },\r\n            timechange() {\r\n                console.log(this.form.date);\r\n                this.Reload();\r\n            },\r\n            cellclick() {\r\n                console.log(JSON.stringify(this.STinfo));\r\n                if (JSON.stringify(this.STinfo) == \"{}\") {\r\n                    this.$Message.warning('请先选择站点');\r\n                } else {\r\n                    if (this.STinfo.bj) {\r\n                        this.STinfo.STCD = this.STinfo.canal_code\r\n                        this.STinfo.STNM = this.STinfo.canal_name\r\n                    }\r\n                    var evt = new Object();\r\n                    evt.graphic = new Object();\r\n                    evt.graphic.attributes = this.STinfo;\r\n                    console.log(this.STinfo);\r\n                    // evt.graphic.attributes.STNM = this.CZMC;\r\n                    // evt.graphic.attributes.STCD = this.STinfo.STCD;\r\n                    evt.graphic.attributes.itype = \"hedaoshuiqing\";\r\n                    evt.graphic.attributes.rowinfo = JSON.parse(JSON.stringify(this.STinfo))\r\n                    evt.graphic.attributes.rowinfo.tableType = {\r\n                        hdsq: \"historyTable\"\r\n                    };\r\n                    var v = new Object;\r\n                    v.itype = \"hedaoshuiqing\";\r\n                    console.log(\"evt\", evt);\r\n                    this.$App.showDrawer(evt, v);\r\n                }\r\n\r\n            },\r\n            drawchart() {\r\n                var achart = this.$echarts.init(this.$refs.achart);\r\n                console.log(achart);\r\n                achart.resize();\r\n                achart.setOption({\r\n                    title: {text: \"\"},\r\n                    tooltip: {\r\n                        trigger: \"axis\"\r\n                    },\r\n                    legend: {\r\n                        data: [\"流量\", \"水位\"]\r\n                    },\r\n                    calculable: true,\r\n                    xAxis: [\r\n                        {\r\n                            type: \"category\",\r\n                            boundaryGap: false,\r\n                            data: this.data2.x.list.reverse(),\r\n                            axisLabel: {interval: parseInt(this.data2.x.list.length / 3.2), rotate: 50},\r\n                        }\r\n                    ],\r\n                    grid: { // 控制图的大小，调整下面这些值就可以，\r\n                        x: 70,\r\n                        x2: 40,\r\n                        y2: 100// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上\r\n                    },\r\n                    yAxis: [\r\n                        {\r\n                            name: \"流量\",\r\n                            type: \"value\",\r\n                            min: this.data2.y1.min,\r\n                            max: this.data2.y1.max\r\n                        },\r\n                        {\r\n                            name: \"水位\",\r\n                            type: \"value\",\r\n                            min: this.data2.y2.min,\r\n                            max: this.data2.y2.max\r\n                        }\r\n                    ],\r\n                    series: [\r\n                        {\r\n                            name: \"水位\",\r\n                            type: \"line\",\r\n                            yAxisIndex: 1,\r\n                            data: this.data2.y1.list.reverse(),\r\n                        },\r\n                        {\r\n                            name: \"流量\",\r\n                            type: \"line\",\r\n                            yAxisIndex: 0,\r\n                            data: this.data2.y2.list.reverse(),\r\n                            itemStyle: {\r\n                                normal: {\r\n                                    color: \"#006400\",//折线点的颜色\r\n                                    lineStyle: {\r\n                                        color: \"#006400\"//折线的颜色\r\n                                    }\r\n                                }\r\n                            },\r\n                            // data: [0.36, 0.28, 0.36, 0.02, 0.12]\r\n                        },\r\n                    ]\r\n                });\r\n            },\r\n            err() {\r\n                this.$Message.warning('该功能还在开发中...');\r\n            },\r\n            changeTree() {\r\n                this.qudao = !this.qudao;\r\n                this.xingzhengquhua = !this.xingzhengquhua;\r\n            },\r\n            Reload() {\r\n                this.loading = true;\r\n                this.axios.get(\"/guanqu/hedaoshuiqing/lishi_lishibiao?_page_size=\" + this.list_input.pagesize + \"&_page=\" + this.list_input.current, {\r\n                    params: {\r\n                        Time_min: this.form.date[0].substr(0, 19),\r\n                        STCD: this.searchs,\r\n                        STNM: this.CZMZ,\r\n                        Time_max: this.form.date[1].substr(0, 19)\r\n                    }\r\n                }).then(res => {\r\n                    console.log(res);\r\n                    this.data1 = res.data.list;\r\n                    if (res.data.total != 0) {\r\n                        // this.CZMC = res.data.list[0].STNM;\r\n                        // this.STinfo = res.data.list[0];\r\n                    }\r\n                    this.list_input.total = res.data.list.length;\r\n                    this.loading = false;\r\n                    for (var i = 0; i < this.data1.length; i++) {\r\n                        this.data1[i].Q = this.Z_Filter(this.data1[i].Q, 3);\r\n                        this.data1[i].Z = this.Z_Filter(this.data1[i].Z);\r\n                        this.data1[i].AWL = this.Z_Filter(this.data1[i].AWL);\r\n\r\n                        console.log(this.data1[i].Z > this.data1[i].AWL);\r\n                    }\r\n                });\r\n                this.axios.get(\"/guanqu/hedaoshuiqing/lishi_lishibiao?_page=1&_page_size=99999\", {\r\n                    params: {\r\n                        Time_min: this.form.date[0].substr(0, 19),\r\n                        STCD: this.searchs,\r\n                        STNM: this.CZMZ,\r\n                        Time_max: this.form.date[1].substr(0, 19)\r\n                    }\r\n                }).then(res => {\r\n                    this.data2 = res.data.list;\r\n                    this.data2 = this.transform_HDSQ_data_into_ehart_data(this.data2, 'historyTable');\r\n                    console.log(this.data2);\r\n                    this.drawchart();\r\n                });\r\n                // 警戒水位\r\n                this.axios.get('/guanqu/table/ST_RIVER_Alarm?STCD=' + this.STinfo.STCD).then(res => {\r\n                    console.log(res);\r\n                    res = res.data.list[0];\r\n                    console.log(res.AWL);\r\n                    // 设置保留小数\r\n                    let strItem = res.AWL.toString().split('.');\r\n                    if (strItem[1] === undefined) {\r\n                        res.AWL = `${res.AWL}.00`;\r\n                    } else if (strItem[1].length === 1) {\r\n                        res.AWL = `${res.AWL}0`;\r\n                    } else if (strItem[1].length >= 3) {\r\n                        res.AWL = item.substring(0, res.AWL.length - 1);\r\n                    } else {\r\n                        res.AWL = res.AWL\r\n                    }\r\n                    console.log(res.AWL);\r\n                    this.A_AWL = res.AWL\r\n                })\r\n            },\r\n            indexMethod(index) {\r\n                return index + 1 + (this.list_input.pagesize * (this.list_input.current - 1));\r\n            },\r\n            // 处理页码切换\r\n            CurrentChange(index) {\r\n                // console.log(index);\r\n                this.list_input.current = index;\r\n                this.Reload();\r\n            },\r\n            // 处理每页显示条数切换\r\n            PagesizeChange(pagesize) {\r\n                // console.log(pagesize)\r\n                this.list_input.pagesize = pagesize;\r\n                this.Reload();\r\n            },\r\n\r\n        },\r\n        computed: {\r\n            balabala() {\r\n                //console.log(this.$store.state.anniu);\r\n                return this.$store.state.anniu\r\n            }\r\n        },\r\n        watch: {\r\n            // 'this.$store.state.anniu': function(){\r\n            //   console.log(this.$store.state.anniu);\r\n            // }\r\n            balabala(curVal, oldVal) {\r\n                console.log(curVal);\r\n                this.test1(curVal)\r\n            }\r\n        },\r\n        created() {\r\n        }\r\n    };\r\n</script>\r\n\r\n<style type=\"text/css\" lang=\"less\">\r\n    .switch {\r\n        position: absolute;\r\n        right: 0;\r\n        top: 0;\r\n        height: 55px;\r\n        display: flex;\r\n        align-items: center;\r\n        background: white;\r\n        border-top-left-radius: 5px;\r\n        border-bottom-left-radius: 5px;\r\n        border: #7eb7f0 2px solid;\r\n        border-right: 0;\r\n    }\r\n</style>\r\n"]}]}