{"remainingRequest":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\huangcaiplace\\zhihuiguanqu\\src\\table\\table-zfsq\\table-history.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\huangcaiplace\\zhihuiguanqu\\src\\table\\table-zfsq\\table-history.vue","mtime":1577669404091},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\huangcaiplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport FilterMethods from \"@/assets/commonJS/FilterMethods\";\nimport GetDataMethods from \"@/assets/commonJS/GetDataMethods\";\nimport App from \"@/App.vue\";\n\nexport default {\n    data() {\n        return {\n            yujingdata: [],\n            loading: false,\n            qudao: true,\n            xingzhengquhua: false,\n            show1: true,\n            Menu: {show_Controller: false},\n            span1: '19',\n            span2: '5',\n            Treedata: [\n                {\n                    title: \"xxx灌区\",\n                    expand: true,\n                    children: [\n                        {\n                            title: \"xxx渠道\",\n                            expand: true,\n                            children: [\n                                {\n                                    title: \"站点A\"\n                                },\n                                {\n                                    title: \"站点B\"\n                                }\n                            ]\n                        },\n                        {\n                            title: \"xxx渠道\",\n\n                            children: [\n                                {\n                                    title: \"站点C\"\n                                }\n                            ]\n                        },\n                        {\n                            title: \"xxx渠道\",\n\n                            children: [\n                                {\n                                    title: \"站点D\"\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ],\n            AD_CD: '',\n            Treedata2: [],\n            GD: '',\n            data1: [],\n            data2: [],\n            changebtn: '切换线形图',\n            date: '',\n            STinfo: {},\n            searchs: \"\",\n            timesearch: '',\n            CZMC: '',\n            echarts: {\n                TM: [],\n                Q: [],\n                UPZ: [],\n                DWZ: [],\n            },\n            form: {\n                searchmsg: '',\n                date: '',\n                field: '',\n            },\n            searchmsg: '',\n            MaxY1: 0,\n            MaxY2: 0,\n            MinY1: 0,\n            MinY2: 0,\n            list_input: {\n                total: 0,\n                pagesize: 50,\n                pagesizeopts: [10, 20, 50, 75, 100, 200],\n                current: 1\n            }\n        };\n    },\n    // 引入过滤方法到此组件\n    mixins: [FilterMethods, GetDataMethods],\n    // watch: {\n    //   searchmsg(val) {\n    //     this.$refs.tree.filter(val);\n    //   }\n    // },\n    mounted() {\n        var date = new Date();\n        var Month = date.getMonth() + 1;\n        var datelist = new Array();\n        var Hours = date.getHours();\n        var Minutes = date.getMinutes();\n        var Seconds = date.getSeconds();\n        if (Hours < 10) {\n            Hours = `0${Hours}`\n        }\n        if (Minutes < 10) {\n            Minutes = `0${Minutes}`\n        }\n        if (Seconds < 10) {\n            Seconds = `0${Seconds}`\n        }\n        if (Month < 10) {\n            Month = `0${Month}`\n        }\n        datelist[0] = `${date.getFullYear()}-${Month}-${date.getDate()} 00:00:00`;\n        datelist[1] = `${date.getFullYear()}-${Month}-${date.getDate()} ${Hours}:${Minutes}:${Seconds}`;\n        this.form.date = datelist;\n        console.log(this.form.date);\n        this.axios.get(\"/guanqu/table/xingzhen_tree?type=5\").then(res => {\n            console.log(res);\n            this.Treedata2 = this.XingZheng_Tree_Filter('650000000000', res.data).data;\n        });\n        //获取输排水渠道数据,然后设置渠道选择框选项\n        this.axios.get(\"/guanqu/table/qudao_tree?type=5\").then(res => {\n            this.Treedata = this.QuDao_Tree_Filter(res.data).data;\n            this.CZMC = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\n            // this.searchs = `&STCD=${this.QuDao_Tree_Filter(res.data).siteinfo.canal_code}`;\n            this.STinfo.STNM = this.QuDao_Tree_Filter(res.data).siteinfo.canal_name;\n            this.STinfo.STCD = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\n            this.searchs = this.QuDao_Tree_Filter(res.data).siteinfo.canal_code;\n            console.log(this.searchs);\n            this.Reload();\n            console.log('渠道', this.QuDao_Tree_Filter(res.data));\n        });\n        // this.Reload();\n    },\n    methods: {\n        sort_change(column) {\n            console.log(column);\n            if (column.order == 'ascending') {\n                this.form.field = column.prop;\n                this.Reload();\n            }\n            if (column.order == 'descending') {\n                this.form.field = column.prop + ' desc';\n                this.Reload();\n            }\n            if (column.order == null) {\n                this.form.field = '';\n                this.Reload();\n            }\n        },\n        Menu_toggle() {\n            this.Menu.show_Controller = !this.Menu.show_Controller;\n            this.show1 = !this.show1;\n            if (this.show1 == true) {\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.Reload();\n            } else {\n                this.span1 = '24';\n                this.span2 = '0';\n                this.data2 = {};\n                this.Reload();\n            }\n        },\n\n        // 监听动态参数事件处理函数\n        test1(agmt) {\n            this.Menu.show_Controller = !agmt;\n            // this.show1 = agmt;\n            if (agmt) {\n                if(this.span1 == '24'){\n                    this.span2 = '0';\n                    this.asyncExecute();\n                    return\n                }\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.asyncExecute()\n            } else {\n                if(this.span1 == '24'){\n                    this.span2 = '0';\n                    this.asyncExecute();\n                    return;\n                }\n                this.span1 = '19';\n                this.span2 = '5';\n                this.data2 = {};\n                this.asyncExecute()\n            }\n        },\n        // 异步刷新，重新绘图\n        asyncExecute(){\n            setTimeout(this.Reload, 100)\n        },\n        qudao_tree(data) {\n            console.log(data);\n            if (data.bj !== 0) {\n                this.searchs = data.canal_code;\n                this.STinfo.STCD = data.canal_code;\n                this.STinfo = data;\n                this.CZMC = data.label.replace('【站点】','');\n                this.Reload();\n            }\n        },\n        xingzheng_tree(data) {\n            console.log(data);\n            if (data.bj !== 0) {\n                this.searchs = data.ad_cd;\n                this.STinfo.STCD = data.ad_cd;\n                this.STinfo = data;\n                this.CZMC = data.label.replace('【站点】','');\n                this.Reload();\n            }\n        },\n        filterNode(value, Treedata, node) {\n            this.filterTreeData.push(node);\n            if (!value) return true;\n            return Treedata.label.indexOf(value) !== -1;\n        },\n        search() {\n            // console.log(this.searchmsg);\n            this.filterTreeData = [];\n            this.$refs.tree.filter(this.searchmsg);\n\n            if (this.searchmsg != '') {\n                this.filterTreeData.some((val, index) => {\n                    // console.log(val.expanded, val.data)\n                    if (val.visible && val.data.bj == 0 && val.data.canal_code) {\n                        console.log(val);\n                        val.isCurrent = true;\n                        this.searchs = `${val.data.canal_code}`;\n                        this.CZMC = val.label.replace('【站点】','');\n                        this.STinfo.STCD = val.data.canal_code;\n                        console.log(\"this.searchmsg\", this.searchmsg)\n                        return true;\n                    } else if (val.visible && val.data.bj == 0 && val.data.ad_cd) {\n                        val.isCurrent = true;\n                        this.searchs = `${val.data.ad_cd}`;\n                        this.STinfo.STCD = val.data.canal_code;\n                        this.CZMC = val.label.replace('【站点】','');\n                        return true;\n                    }\n                });\n                this.Reload();\n            } else {\n                // this.searchs = '';\n                this.Reload();\n            }\n        },\n        timechange() {\n            console.log(this.form.date);\n            this.Reload();\n        },\n        cellclick() {\n            console.log(JSON.stringify(this.STinfo));\n            if (JSON.stringify(this.STinfo) == \"{}\") {\n                this.$Message.warning('请先选择站点');\n            } else {\n                if(this.STinfo.bj){\n                    this.STinfo.STCD = this.STinfo.canal_code\n                }\n                // 给将要传过去的参数添加预警信息\n                this.yujingdata.forEach(item => {\n                   if(item.rowinfo.STCD === this.STinfo.STCD){\n                       this.STinfo.YUJING_EZ = item.rowinfo.YUJING_EZ;\n                       this.STinfo.YUJING_JYEZ = item.rowinfo.YUJING_JYEZ;\n                       this.STinfo.YUJING_JYQ = item.rowinfo.YUJING_JYQ;\n                       this.STinfo.YUJING_JYSZ = item.rowinfo.YUJING_JYSZ;\n                       this.STinfo.YUJING_Q = item.rowinfo.YUJING_Q;\n                       this.STinfo.YUJING_SZ = item.rowinfo.YUJING_SZ;\n                   }\n                });\n                console.log(this.STinfo)\n                var evt = new Object();\n                evt.graphic = new Object();\n                evt.graphic.attributes = this.STinfo;\n                evt.graphic.attributes.STNM = this.CZMC;\n                evt.graphic.attributes.itype = \"zhafashuiqing\";\n                evt.graphic.attributes.rowinfo = JSON.parse(JSON.stringify(this.STinfo))\n                evt.graphic.attributes.rowinfo.tableType = {\n                    zfsq: \"historyTable\"\n                };\n                var v = new Object;\n                v.itype = \"zhafashuiqing\";\n                console.log(\"evt\", evt);\n                this.$App.showDrawer(evt, v);\n            }\n        },\n        drawchart() {\n            var achart = this.$echarts.init(this.$refs.achart);\n            console.log(achart);\n            achart.resize();\n            achart.setOption({\n                title: {text: \"\"},\n                tooltip: {\n                    trigger: \"axis\"\n                },\n                legend: {\n                    data: [\"流量\", \"闸前水深\", \"闸后水深\"]\n                },\n                calculable: true,\n                xAxis: [\n                    {\n                        type: \"category\",\n                        boundaryGap: false,\n                        data: this.data2.x.list,\n                        axisLabel: {interval: parseInt(this.data2.x.list.length / 3.2), rotate: 50},\n                    }\n                ],\n                grid: { // 控制图的大小，调整下面这些值就可以，\n                    x: 70,\n                    x2: 40,\n                    y2: 100// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上\n                },\n                yAxis: [\n                    {\n                        name: \"流量\",\n                        type: \"value\",\n                        min: this.data2.y1.min,\n                        max: this.data2.y1.max\n                    },\n                    {\n                        name: \"水深\",\n                        type: \"value\",\n                        min: this.data2.y2.min,\n                        max: this.data2.y2.max\n                    }\n                ],\n                series: [\n                    {\n                        name: \"流量\",\n                        type: \"line\",\n                        yAxisIndex: 0,\n                        data: this.data2.y1.list,\n                        itemStyle: {\n                            normal: {\n                                color: \"#006400\",//折线点的颜色\n                                lineStyle: {\n                                    color: \"#006400\"//折线的颜色\n                                }\n                            }\n                        },\n                        // data: [0.36, 0.28, 0.36, 0.02, 0.12]\n                    },\n                    {\n                        name: \"闸前水深\",\n                        type: \"line\",\n                        yAxisIndex: 1,\n                        data: this.data2.y2.list,\n                        itemStyle: {\n                            normal: {\n                                color: \"#8B0000\",//折线点的颜色\n                                lineStyle: {\n                                    color: \"#8B0000\"//折线的颜色\n                                }\n                            }\n                        },\n                        // data: [5.0, 10.0, 20.0, 25.0, 22.0]\n                    },\n                    {\n                        name: \"闸后水深\",\n                        type: \"line\",\n                        yAxisIndex: 1,\n                        data: this.data2.y3.list,\n                        itemStyle: {\n                            normal: {\n                                color: \"#9400D3\",//折线点的颜色\n                                lineStyle: {\n                                    color: \"#9400D3\"//折线的颜色\n                                }\n                            }\n                        },\n                        // data: [5.0, 10.0, 20.0, 25.0, 22.0]\n                    },\n                ]\n            });\n        },\n        err() {\n            this.$Message.warning('该功能还在开发中...');\n        },\n        changeTree() {\n            this.qudao = !this.qudao;\n            this.xingzhengquhua = !this.xingzhengquhua;\n        },\n        Reload() {\n            this.loading = true;\n            console.log(this.searchs);\n            let obj = {\n                Time_min: this.form.date[0].substr(0, 19),\n                Time_max: this.form.date[1].substr(0, 19),\n                STCD: this.searchs,\n                _orderby: this.form.field\n\n            }\n\n            // console.log(this.list_input.current + this.searchs);\n            this.axios.get(\"/guanqu/zhafashuiqing/lishi_lishibiao?_page_size=\" + this.list_input.pagesize + \"&_page=\" + this.list_input.current , {\n                params: obj\n            }).then(res => {\n                console.log(res.data.list);\n                this.data1 = res.data.list;\n                if (res.data.total != 0) {\n                    // this.CZMC = res.data.list[0].STNM;\n                    // this.STinfo = res.data.list[0];\n                }\n                // this.CZMC = '南岭泄洪闸站';\n                this.list_input.total = res.data.total;\n                this.loading = false;\n                for (var i = 0; i < this.data1.length; i++) {\n                    this.data1[i].Q = this.Z_Filter(this.data1[i].Q, 3);\n                    this.data1[i].UPZ = this.Z_Filter(this.data1[i].UPZ);\n                    this.data1[i].DWZ = this.Z_Filter(this.data1[i].DWZ);\n                    this.data1[i].TM = this.dateFilter(this.data1[i].TM);\n                }\n            });\n            this.axios.get(\"/guanqu/zhafashuiqing/lishi_lishibiao?_page=1&_page_size=99999\" , {params: obj}).then(res => {\n                this.data2 = res.data.list.reverse();\n                console.log(this.data2)\n                for (var i = 0; i < this.data2.length; i++) {\n                    this.data2[i].TM = this.dateFilter(this.data2[i].TM);\n                }\n                this.data2 = this.transform_ZFSQ_data_into_ehart_data(this.data2, 'historyTable');\n                // console.log(this.transform_ZFSQ_data_into_ehart_data(this.data2,'historyTable'));\n                this.drawchart();\n            });\n\n            // 取预警信息\n            this.axios.get('/guanqu/zhafashuiqing/gis').then(res => {\n                console.log('++++++++++++', res);\n                this.yujingdata = res.data.features;\n            });\n        },\n        indexMethod(index) {\n            return index + 1 + (this.list_input.pagesize * (this.list_input.current - 1));\n        },\n        // 处理页码切换\n        CurrentChange(index) {\n            // console.log(index);\n            console.log(this.STinfo.STCD);\n            this.list_input.current = index;\n            this.Reload();\n        },\n        // 处理每页显示条数切换\n        PagesizeChange(pagesize) {\n            // console.log(pagesize)\n            this.list_input.pagesize = pagesize;\n            this.Reload();\n        }\n    },\n    created() {\n\n    },\n    computed: {\n        balabala() {\n            //console.log(this.$store.state.anniu);\n            return this.$store.state.anniu\n        }\n    },\n    watch: {\n        // 'this.$store.state.anniu': function(){\n        //   console.log(this.$store.state.anniu);\n        // }\n        balabala(curVal, oldVal) {\n            console.log(curVal);\n            this.test1(curVal)\n        }\n    },\n};\n",null]}