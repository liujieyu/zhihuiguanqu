{"remainingRequest":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work2022\\visualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-warmmessage\\warmmessage.vue?vue&type=style&index=0&lang=less&scope=true&","dependencies":[{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\src\\warm\\warm-manage\\warm-warmmessage\\warmmessage.vue","mtime":1645514326392},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\less-loader\\dist\\cjs.js","mtime":1642129565717},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work2022\\visualplace\\zhihuiguanqu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n@import \"../../../components/Details/common/common.less\";\r\n.cardcss{\r\n    width:90%;\r\n    margin-left:16px;\r\n}\r\n.footer{\r\nbackground:#fff;\r\ntext-align:center;\r\n}\r\n.warm_detail {\r\n  td {\r\n    height: 45px;\r\n    border-top: none;\r\n    border-color: #C7CCD6;\r\n  }\r\n\r\n  .dt_name {\r\n    width: 18px;\r\n    border-right: #C7CCD6 1px solid;\r\n    border-bottom: #C7CCD6 1px solid;\r\n  }\r\n\r\n  .dt_vale {\r\n    width: 82%;\r\n    border-bottom: #C7CCD6 1px solid;\r\n  }\r\n}\r\n.nav {\r\n    height: 50px;\r\n    border-top: #C7CCD6 1px solid;\r\n}\r\n \r\n.nav ul {\r\n    list-style: none;\r\n}\r\n \r\n.nav li {\r\n    display: inline;\r\n    line-height: 40px;\r\n    float:left;\r\n    padding-left: 10px;\r\n    padding-top: 10px;\r\n}\r\n\r\n",{"version":3,"sources":["warmmessage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"warmmessage.vue","sourceRoot":"src/warm/warm-manage/warm-warmmessage","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<Content>\r\n            <div ref=\"first\">\r\n            <Card class=\"cardcss\">\r\n                <p slot=\"title\">预警短信信息输入</p>\r\n            <el-form ref=\"form\" :model=\"form\" label-width=\"100px\" size=\"small\">\r\n                <el-form-item label=\"发送平台：\">\r\n                    <RadioGroup v-model=\"form.plan\">\r\n                        <Radio v-for=\"item in planlist\" :label=\"item.value\" size=\"large\" name=\"plans\">{{item.label}}</Radio>\r\n                    </RadioGroup>\r\n                </el-form-item>\r\n                <el-form-item label=\"预警等级：\">\r\n                    <Select v-model=\"form.yjdj\"  style=\"width:200px;\" clearable>\r\n                        <Option v-for=\"item in yjdjlist\" :value=\"item.value\" :key=\"item.value\">{{ item.label }}</Option>\r\n                    </Select>\r\n                </el-form-item>\r\n                <el-form-item label=\"短信内容：\">\r\n                    <Input type=\"textarea\" v-model=\"form.content\" :rows=\"4\" :value=\"form.content\" clearable style=\"width:98%\" />\r\n                    <div style=\"color:red;font-size:11px;\">(短信内容不超过70个汉字)</div>\r\n                </el-form-item>\r\n            </el-form>\r\n            <Footer class=\"footer\">\r\n            <Button  type=\"primary\" @click=\"nextstep(2)\" icon=\"md-arrow-round-down\" size=\"large\">下一步</Button>\r\n            <Button  @click=\"clearOne\" style=\"margin-left:20px;\" icon=\"md-trash\" size=\"large\">清空</Button>\r\n            </Footer>\r\n            </Card>\r\n            </div>\r\n            <div ref=\"second\" style=\"display:none;\">\r\n                <Card class=\"cardcss\">\r\n                <p slot=\"title\">发送对象选择</p>\r\n                    <el-table\r\n                        :data=\"form.allinfo\"\r\n                        border\r\n                        style=\"width: 100%\"\r\n                        >\r\n                        <el-table-column label=\"人员类型\" align=\"left\" width=\"160\" >\r\n                          <template slot-scope=\"scope\">\r\n                          <Checkbox :label=\"scope.row.type\"  :name=\"scope.row.type\" size=\"large\" @on-change=\"checkone(scope.row.type,$event)\">{{scope.row.title}}</Checkbox>\r\n                           </template>\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                          prop=\"manname\"\r\n                          label=\"已选择人员\"\r\n                          align=\"center\"\r\n                          min-width=\"200\">\r\n                        </el-table-column>\r\n                      </el-table>\r\n                    <Footer class=\"footer\">\r\n                    <Button  type=\"primary\" @click=\"prestep(1)\" icon=\"md-arrow-round-up\" size=\"large\">上一步</Button>\r\n                    <Button  type=\"primary\" @click=\"nextstep(3)\" style=\"margin-left:20px;\" icon=\"md-arrow-round-down\" size=\"large\">下一步</Button>\r\n                    <Button  @click=\"clearTwo\" style=\"margin-left:20px;\" icon=\"md-trash\" size=\"large\">清空</Button>\r\n                    </Footer>\r\n               </Card>\r\n            </div>\r\n            <div ref=\"third\" style=\"display:none;\">\r\n              <Card class=\"cardcss\">\r\n                <p slot=\"title\">预警短信信息核对</p>\r\n                <table style=\"border: 1px solid #C7CCD6\" cellspacing=\"0\" width=\"100%\" class=\"warm_detail\">\r\n                <tr>\r\n                  <td align=\"right\" class=\"dt_name\">发送平台：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"padding-left:10px;\">{{ form.planname || \"&nbsp;\" }}</td>\r\n                </tr>\r\n                <tr>\r\n                    <td align=\"right\" class=\"dt_name\" >预警等级：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"padding-left:10px;\">{{form.yjdjname|| \"&nbsp;\"}}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td align=\"right\" class=\"dt_name\">预警内容：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"padding-left:10px;border-bottom:0px;\">{{ form.content || \"&nbsp;\" }}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td align=\"right\" class=\"dt_name\" style=\"border-bottom:0px;\">发送对象：</td>\r\n                  <td align=\"left\" class=\"dt_vale\" style=\"border-bottom:0px;\">\r\n                      <table cellspacing=\"0\" style=\"width:100%;\">\r\n                          <tr v-for=\"item in form.allinfo\" v-if=\"item.count>0\">\r\n                              <td style=\"width:150px;border-top: 1px solid #C7CCD6;border-right: 1px solid #C7CCD6;padding-left:10px;\">\r\n                                  <Badge :count=\"item.count\">\r\n                                    <Avatar shape=\"square\" icon=\"ios-person\" />\r\n                                </Badge>\r\n                                <div style=\"display:block-inline;float:right;\">\r\n                               {{item.title}}：\r\n                               </div>\r\n                              </td>\r\n                              <td style=\"border-top: 1px solid #C7CCD6;padding:10px 5px 5px 10px;\">\r\n                                  {{item.manname}}\r\n                              </td>\r\n                          </tr>\r\n                      </table>\r\n                  </td>\r\n                </tr>\r\n              </table>\r\n                <Footer class=\"footer\">\r\n                    <Button type=\"primary\" @click=\"prestep(2)\" icon=\"md-arrow-round-up\" size=\"large\">上一步</Button>\r\n                    <Button type=\"primary\" @click=\"onSubmit\" style=\"margin-left:20px;\" icon=\"md-cloud-upload\" size=\"large\">发送</Button>\r\n                </Footer>\r\n              </Card>\r\n            </div>\r\n        </Content>\r\n    </div>\r\n</template>\r\n<script type=\"text/javascript\">\r\n        import WarmDataConfig from \"@/assets/commonJS/WarmDataConfig\";\r\n\texport default {\r\n        props: {\r\n            maninfo: {}\r\n        },\r\n        data(){\r\n            return{\r\n                social:[],\r\n                planlist:[],\r\n                typelist:[],\r\n                yjdjlist:[],\r\n                mancount:0,\r\n                form:{\r\n                    plan:'',\r\n                    planname:'',\r\n                    phone:'',\r\n                    name:'',\r\n                    content:'',\r\n                    yjdj:'',\r\n                    yjdjname:'',\r\n                    allinfo:[]\r\n                },\r\n            }\r\n        },\r\n        // 引入过滤方法到此组件\r\n        mixins: [WarmDataConfig],\r\n        mounted(){\r\n            this.Reload();\r\n        },\r\n        methods:{\r\n            Reload(){\r\n                //发送平台\r\n                this.Get_SysForminfo('DXFS20190921',1,data => {\r\n                    this.planlist = data;\r\n                    this.form.plan=data[0].value;\r\n                });\r\n                //预警等级\r\n                this.Get_WrpFieldinfo('ST_AlarmInfo','Alarm',data => {\r\n                    this.yjdjlist = data;\r\n                });\r\n                //发送对象\r\n                this.Get_WrpFieldinfo('WRP_MAN','TYPES',data => {\r\n                    var typelist = data;\r\n                    this.tabledata=new Array();\r\n                    this.form.allinfo=new Array();\r\n                    for(var i=0;i<typelist.length;i++){\r\n                        var info=new Object();\r\n                        info.type=typelist[i].value;\r\n                        info.title=typelist[i].label;\r\n                        info.manname=\"\";\r\n                        info.count=0;\r\n                        info.itype=\"fasongrenyuan\";\r\n                        info.list=new Array();\r\n                        this.form.allinfo.push(info);\r\n                    }\r\n                });\r\n            },\r\n            //选择人员\r\n            checkone(val,event){\r\n                if(event){\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n                            this.$emit('showdailog', this.form.allinfo[i]);\r\n                        }\r\n                    }\r\n                }else{\r\n                    for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(val==this.form.allinfo[i].type){\r\n                            this.form.allinfo[i].manname=\"\";\r\n                            this.form.allinfo[i].count=0;\r\n                            this.form.allinfo[i].list=new Array();\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n           //设置手机号码\r\n           showphone(dataobj){              \r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                        if(dataobj.type==this.form.allinfo[i].type){\r\n                            this.form.allinfo[i].list=dataobj.list;\r\n                            this.form.allinfo[i].count=dataobj.list.length;\r\n                            var names=\"\";\r\n                            for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                                names+=this.form.allinfo[i].list[t].NM+\"，\";\r\n                            }\r\n                            this.form.allinfo[i].manname=names.substr(0,names.length-1);\r\n                            break;\r\n                        }\r\n                    }\r\n                \r\n                \r\n           },\r\n           //取消复选框选中\r\n           cancelcheck(val){\r\n               document.getElementsByName(val)[0].click();\r\n           },\r\n           onSubmit(){\r\n            var appid=\"预警短信 \"+this.form.yjdjname;\r\n            var sender=this.form.planname;\r\n            var tablename=this.form.plan;\r\n            var content=this.form.content;\r\n\r\n            var count=0;\r\n            for(var i=0;i<this.form.allinfo.length;i++){\r\n                    if(this.form.allinfo[i].list.length>0){\r\n                        for(var t=0;t<this.form.allinfo[i].list.length;t++){\r\n                            var receiver=this.form.allinfo[i].list[t].MOBILE;\r\n                            var addtion1=this.form.allinfo[i].list[t].NM;\r\n                            var addtion2=this.form.allinfo[i].list[t].UNIT;\r\n                            var addtion3=this.form.allinfo[i].list[t].ZW;                        \r\n                            let postData=new Object();\r\n                            postData[\"appid\"]=appid;\r\n                            postData[\"sender\"]=sender;\r\n                            postData[\"tablename\"]=tablename;\r\n                            postData[\"receiver\"]=receiver;\r\n                            postData[\"addtion1\"]=addtion1;\r\n                            postData[\"addtion2\"]=addtion2;\r\n                            postData[\"addtion3\"]=addtion3;\r\n                            postData[\"content\"]=content;\r\n                            this.axios.post('/alarm/addmessage',postData).then((res)=>{\r\n                                if(res.data==\"ok\"){\r\n                                    count+=1;\r\n                                }                   \r\n                            }); \r\n                        }\r\n                    }\r\n                }\r\n              var successtime=  setInterval(() => {\r\n                    if(this.mancount==count){\r\n                        this.$message({message:'预警短信发送成功！',type:'success'});\r\n                        clearInterval(successtime);\r\n                        this.clearOne();\r\n                        this.clearTwo();\r\n                        this.$refs['first'].style.display=\"\";\r\n                        this.$refs['third'].style.display=\"none\";\r\n                    }\r\n                }, 500);\r\n           }, \r\n           clearOne(){\r\n               this.form.plan=this.planlist[0].value;\r\n               this.form.yjdj=\"\";\r\n               this.form.content=\"\";\r\n           },\r\n           clearTwo(){\r\n               for(var i=0;i<this.form.allinfo.length;i++){\r\n                   var box=document.getElementsByName(this.form.allinfo[i].type);\r\n                   if (box[0].checked==true) {\r\n                      box[0].click();\r\n                   }\r\n               }\r\n           },\r\n           nextstep(step){\r\n               //第一步验证\r\n               if(step==2){\r\n                   if(typeof(this.form.yjdj)==\"undefined\" || this.form.yjdj==\"\"){\r\n                       this.$message({message:'请选择预警等级！',type:'warning'});\r\n                       return;\r\n                   }\r\n                   var str=this.form.content;\r\n                    if(str.replace(\" \",\"\")==\"\"){\r\n                        this.$message({message:'请输入短信内容！',type:'warning'});\r\n                        return;\r\n                    }\r\n                    if(this.strlen(str)>=140){\r\n                        this.$message({message:'短信内容不能超过70个汉字！',type:'warning'});\r\n                        return;\r\n                    }\r\n                    //发送平台名称\r\n                    for(var t=0;t<this.planlist.length;t++){\r\n                        if(this.form.plan==this.planlist[t].value){\r\n                            this.form.planname=this.planlist[t].label;\r\n                            break;\r\n                        }\r\n                    }\r\n                    //预警等级名称\r\n                    for(var t=0;t<this.yjdjlist.length;t++){\r\n                        if(this.form.yjdj==this.yjdjlist[t].value){\r\n                            this.form.yjdjname=this.yjdjlist[t].label;\r\n                            break;\r\n                        }\r\n                    }\r\n                    this.$refs['first'].style.display=\"none\";\r\n                    this.$refs['second'].style.display=\"\";\r\n               }//第二步验证\r\n               else{\r\n                   this.mancount=0;\r\n                   for(var i=0;i<this.form.allinfo.length;i++){\r\n                      this.mancount+=this.form.allinfo[i].list.length;\r\n                   }\r\n                   if(this.mancount==0){\r\n                       this.$message({message:'请选择发送对象！',type:'warning'});\r\n                        return;\r\n                   }\r\n                   this.$refs['second'].style.display=\"none\";\r\n                   this.$refs['third'].style.display=\"\";\r\n               }\r\n           },\r\n           prestep(step){\r\n               if(step==1){\r\n                  this.$refs['first'].style.display=\"\";\r\n                  this.$refs['second'].style.display=\"none\"; \r\n               }else if(step==2){\r\n                  this.$refs['second'].style.display=\"\";\r\n                  this.$refs['third'].style.display=\"none\";\r\n               }\r\n           }\r\n        }\r\n    }\r\n</script>\r\n<style lang=\"less\" scope>\r\n@import \"../../../components/Details/common/common.less\";\r\n.cardcss{\r\n    width:90%;\r\n    margin-left:16px;\r\n}\r\n.footer{\r\nbackground:#fff;\r\ntext-align:center;\r\n}\r\n.warm_detail {\r\n  td {\r\n    height: 45px;\r\n    border-top: none;\r\n    border-color: #C7CCD6;\r\n  }\r\n\r\n  .dt_name {\r\n    width: 18px;\r\n    border-right: #C7CCD6 1px solid;\r\n    border-bottom: #C7CCD6 1px solid;\r\n  }\r\n\r\n  .dt_vale {\r\n    width: 82%;\r\n    border-bottom: #C7CCD6 1px solid;\r\n  }\r\n}\r\n.nav {\r\n    height: 50px;\r\n    border-top: #C7CCD6 1px solid;\r\n}\r\n \r\n.nav ul {\r\n    list-style: none;\r\n}\r\n \r\n.nav li {\r\n    display: inline;\r\n    line-height: 40px;\r\n    float:left;\r\n    padding-left: 10px;\r\n    padding-top: 10px;\r\n}\r\n\r\n</style>"]}]}